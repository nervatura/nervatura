<!DOCTYPE html>
<html lang="en">
	<head>
	  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	  <title>Nervatura Application Server</title>
	  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no" />
			
	  <style type="text/css">
		.body {
      font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
		  font-size: 1em;
      background-color: #ffffff;
		  padding: 20pt 42.5pt 42.5pt 42.5pt;
		  text-align: justify;
		  color: #444444;
		}
		a {
		  text-decoration: none;
		  color: #3B7687;
		}
    ul {
      text-align: left;
    }
		.code {
      font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
      font-size: .85em;
		  background-color: #F5F5F5;
		  padding: 10px;
      margin: 10px 0px;
      text-align: left;
		}
	  </style>
	</head>
<body class="body">
  <h1 align="center" style="margin-top: 0px;">
    Nervatura Application Server 
  </h1>
  <h2 align="center">Admin Guide</h2>
  <!--<p align="center"><b><i>Ver.No: <%= settings.version %></i></b></p>-->
  
  <ol style="color: #3B7687;">
    <li><b><a href="#install">Installation</a></b>
      <ul style="padding-left:5px;">
        <li style="padding:3px 0px 0px;"><a href="#install_default">Default packages</a></li>
        <li style="padding:3px 0px 0px;"><a href="#install_quick">Quick Start</a></li>
        <li style="padding:3px 0px 0px;"><a href="#install_optional">Optional packages</a></li>
      </ul>
    </li>
    <li style="padding:5px 0px 0px;"><b><a href="#cloud">Cloud Hosting Services</a></b>
      <ul style="padding-left:5px;">
        <li style="padding:3px 0px 0px;"><a href="#app_engine">Google App Engine</a></li>
        <li style="padding:3px 0px 0px;"><a href="#azure">Microsoft Azure</a></li>
        <li style="padding:3px 0px 0px;"><a href="#cloud_openshift">OpenShift</a></li>
        <li style="padding:3px 0px 0px;"><a href="#cloud_docker">Docker</a></li>
      </ul>
    </li>
    <li style="padding:5px 0px 0px;"><b><a href="#config">Server config</a></b></li>
    <li style="padding:5px 0px 0px;"><b><a href="#other">Other recipes</a></b>
      <ul style="padding-left:5px;">
        <li style="padding:3px 0px 0px;"><a href="#customize">Customize the appearance</a></li>
        <li style="padding:3px 0px 0px;"><a href="#migration">Database migration</a></li>
        <li style="padding:3px 0px 0px;"><a href="#printer">Server-side printers</a></li>
        <li style="padding:3px 0px 0px;"><a href="#emails">Sending Emails</a></li>
        <li style="padding:3px 0px 0px;"><a href="#security">Security Issues</a></li>
      </ul>
    </li>
  </ol>
  
  <hr>
  
	<h3>
		<a name="install">1. Installation</a>
	</h3>
  
  <ul>
    <li><b><a name="install_default">Default packages</a></b>
      <p class="code" style="text-align: left;">
        $ npm install nervatura --production
      </p>
      or
      <p class="code" style="text-align: left;">
        $ git clone https://github.com/nervatura/nervatura.git<br>
        $ cd nervatura<br>
        $ npm install --production
      </p>
    </li>
    <li><b><a name="install_quick">Quick Start</a></b>
      <ul style="padding:10px;">
        <li>development mode
          <p class="code" style="text-align: left;">
            $ npm run dev
          </p>
          <p>and <a href="http://localhost:8080/" target="_blank">http://localhost:8080/</a></p>
        </li>
        <li>production mode
          <p class="code" style="text-align: left;">
            $ npm start
          </p>
          <p>and <a href="https://localhost:8080/" target="_blank">https://localhost:8080/</a></p>
        </li>
        <li>or change the file <a href="https://github.com/nervatura/nervatura/blob/master/.npmrc" 
          target="blank">.npmrc</a>: production = true/false, and
          <p class="code" style="text-align: left;">
            $ npm start
          </p>
        </li>
      </ul>
      
    </li>
    <li><b><a name="install_optional">Optional packages</a></b><br>
      <p><span style="color:#8B1A1A;font-weight:bold;">Server-side printing</span></p>
      <p>UNIX-like operating systems: <a href="http://www.cups.org/" target="_blank">CUPS</a> and 
        <a href="https://github.com/tojocky/node-printer" target="_blank">node-printer</a></li></p>
      <p class="code" style="text-align: left;">
        $ npm install printer --save
      </p>
      <p>Windows systems: <a href="http://www.ghostscript.com/Ghostscript.html" target="_blank">Ghostscript</a> 
        and <a href="http://pages.cs.wisc.edu/~ghost/gsview/gsprint.htm" target="_blank">GSPRINT</a></p>
      <p><a href="http://www.google.com/cloudprint/learn/" target="_blank">Google Cloud Print</a>: 
        <a href="https://github.com/simoncadman/CUPS-Cloud-Print" target="_blank">CUPS-Cloud-Print</a></p>
      
      <p><span style="color:#8B1A1A;font-weight:bold;">Session and data store</span></p>
      <p>PouchDB:</p>
      <p class="code" style="text-align: left;">
        $ npm install pouchdb-node --save
      </p>
    </li>
  </ul>
  
  <h3>
		<a name="cloud">2. Cloud Hosting Services</a>
	</h3>
  
  <ul>
    <li><b><a name="app_engine">Google App Engine</a></b>
      <p>Use the <a href="https://console.cloud.google.com/" target="blank">Cloud Platform Console</a> 
        to create a new Cloud Platform project, create an App Engine application, and enable billing.<br>
        Download and install the <a href="https://cloud.google.com/sdk/docs/" target="blank">Google Cloud SDK</a> 
        and then initialize the gcloud tool.</p>
      <p class="code" style="text-align: left;">
        git clone https://github.com/nervatura/nervatura.git nervatura_gae<br>
        cd nervatura_gae<br>
      </p>
      <p>Remove the Dockerfile from this directory:</p>
      <p class="code" style="text-align: left;">
        rm ./Dockerfile
      </p>
      <p>If necessary, modify the <a 
        href="https://github.com/nervatura/nervatura/blob/master/app.yaml" 
        target="blank"><b>app.yaml</b></a> and <a 
        href="https://github.com/nervatura/nervatura/blob/master/lib/node/conf.js" 
        target="blank">lib/node/<b>conf.js</b></a> file (see below). Deploy the 
        Nervatura by running the following command:</p>
      <p class="code" style="text-align: left;">
        gcloud app deploy --project <span style="font-weight:bold;">YOUR_PROJECT_ID</span>
      </p>
      <p>Launch your browser and view the app at http://<b>your_project_id</b>.appspot.com, by running 
        the following command:</p>
      <p class="code" style="text-align: left;">
        gcloud app browse
      </p>

      <p><span style="color:#8B1A1A;font-weight:bold;">Google (OAuth 2.0) authentication</span></p>
      <p>Enable the <a href="https://console.cloud.google.com/flows/enableapi?apiid=plus" 
        target="blank">Google+ API</a>. Any application that uses OAuth 2.0 to access Google APIs must have authorization credentials that identify 
        the application to Google's OAuth 2.0 server. See more here: <a 
        href="https://developers.google.com/identity/protocols/OAuth2WebServer" target="blank">Using OAuth 2.0 
        for Web Server Applications</a></p>
      <p>Before you deploy the application, modify the following section in the <a 
        href="https://github.com/nervatura/nervatura/blob/master/app.yaml" target="blank"><b>app.yaml</b></a> file:</p>
      <p class="code" style="text-align: left;">
        GOOGLE_CLIENT_ID: <b>YOUR_GOOGLE_CLIENT_ID</b><br>
        GOOGLE_CLIENT_SECRET: <b>YOUR_GOOGLE_CLIENT_SECRET</b>
      </p>
      <p>1. Login to NAS Admin GUI</p>
      <ul>
        <li>Username: <b>admin</b></li>
        <li>Password: <b>leave the field empty, not needed</b> (Default. Please change after the first login!)</li>
      </ul>
      <p>2. Add a new user (User Accounts)</p>
      <ul>
        <li>Username: <b>a valid(!) Google email</b></li>
        <li>Password: <b>leave the field empty, not needed</b></li>
      </ul>
      <p>3. Remove the admin user (optional) and modify the following setting (Server Settings):</p>
      <ul>
        <li>Fieldname: <b>nas_auth</b></li>
        <li>Value: <b>google</b></li>
      </ul>
      <p>4. Log off and re-enter the new user.</p>

      <p><span style="color:#8B1A1A;font-weight:bold;">Databases support</span></p>
      <p><b>SQLite</b> install: Included by default. Recommended for testing only!</p>
      <p><b>PostgeSQL</b> instance:</p>
      <p>Enable the <a href="https://console.cloud.google.com/flows/enableapi?apiid=sqladmin" 
        target="blank">Cloud SQL API</a>. Creating an instance and setting the password:</p>
      <p class="code" style="text-align: left;">
        gcloud sql instances create <b>[INSTANCE_NAME]</b> --database-version=POSTGRES_9_6 \<br>
        --cpu=<b>[NUMBER_CPUS]</b> --memory=<b>[MEMORY_SIZE]</b><br><br>
        gcloud sql users set-password postgres no-host --instance=<b>[INSTANCE_NAME]</b> \<br>
        --password=<b>[PASSWORD]</b>
      </p>
      <p>See more here: <a 
        href="https://cloud.google.com/sql/docs/postgres/create-instance" target="blank">Creating PostgreSQL Instances</a></p>
      <p><b>MySQL</b> instance:</p>
      <p>Enable the <a href="https://console.cloud.google.com/flows/enableapi?apiid=sqladmin" 
        target="blank">Cloud SQL API</a>. Creating an instance and setting the password:</p>
      <p class="code" style="text-align: left;">
        gcloud sql instances create <b>[INSTANCE_NAME]</b> --tier=<b>[MACHINE_TYPE]</b> --region=<b>[REGION]</b><br><br>
        gcloud sql users set-password root % --instance <b>[INSTANCE_NAME]</b> --password <b>[PASSWORD]</b>
      </p>
      <p>See more here: <a 
        href="https://cloud.google.com/sql/docs/mysql/create-instance#create-2nd-gen" target="blank">Creating MySQL Instances</a></p>
      <p>To allow your app to connect to your Cloud SQL instance when the app is deployed, add the user, 
        password, database, and instance connection name variables from Cloud SQL to the related environment 
        variables in the <a href="https://github.com/nervatura/nervatura/blob/master/app.yaml" 
        target="blank"><b>app.yaml</b></a> file: The deployed application will connect via unix sockets.</p>
      <p class="code" style="text-align: left;">
        env_variables:<br>
        &nbsp;&nbsp;SQL_USER: <b>YOUR_SQL_USER</b><br>
        &nbsp;&nbsp;SQL_PASSWORD: <b>YOUR_SQL_PASSWORD</b><br>
        &nbsp;&nbsp;SQL_DATABASE: <b>YOUR_SQL_DATABASE</b><br>
          # e.g. my-awesome-project:us-central1:my-cloud-sql-instance<br>
        &nbsp;&nbsp;INSTANCE_CONNECTION_NAME: <b>YOUR_INSTANCE_CONNECTION_NAME</b><br><br>

        beta_settings:<br>
        &nbsp;&nbsp;cloud_sql_instances: <b>YOUR_INSTANCE_CONNECTION_NAME</b>
      </p>
      <p>See more here: <a 
        href="https://cloud.google.com/appengine/docs/flexible/nodejs/using-cloud-sql" 
        target="blank">Using Cloud SQL for MySQL</a> and <a 
        href="https://cloud.google.com/appengine/docs/flexible/nodejs/using-cloud-sql-postgres" 
        target="blank">Using Cloud SQL for PostgreSQL</a></p>
      
      <p><span style="color:#8B1A1A;font-weight:bold;">Create a new Nervatura database</span></p>
      <p>1. Login to NAS Admin GUI</p>
      <p>2. Add/Edit a new customer database reference</p>
      <p>3.1 NAS SQLite database settings (optional)</p>
      <ul>
        <li>Alias: <b>demo</b> (or what you prefer)</li>
        <li>Engine: <b>SQLite</b></li>
        <li>Host: <b>leave the field empty, not needed</b></li>
        <li>Port: <b>leave the field empty, not needed</b></li>
        <li>Database: <b>demo</b> (or what you prefer)</li>
        <li>Other settings: <b>default</b> (or what you prefer)</li>
      </ul>
      <p><i>You can create an unlimited number of SQLite databases. Recommended for testing only!</i></p>
      
      <p>3.2. NAS PostgreSql and MySQL database settings (optional)</p>
      <ul>
        <li>Alias: <b>pgdemo</b> or <b>mydemo</b> (or what you prefer)</li>
        <li>Engine: <b>PostgreSQL</b> or <b>MySQL</b></li>
        <li>Host: <b>/cloudsql/$INSTANCE_CONNECTION_NAME</b></li>
        <li>Port: <b>leave the field empty, not needed</b></li>
        <li>Database: <b>$SQL_DATABASE</b></li>
        <li>UserName: <b>$SQL_USER</b></li>
        <li>Password: <b>$SQL_PASSWORD</b></li>
        <li>Other settings: <b>default</b> (or what you prefer)</li>
      </ul>
      <p><i>For each application you can configure only one postgresql or one mysql database!</i></p>
      
      <p>4. Create a new Nervatura database</p>
      <p>Database alias:</p>
      <ul>
        <li><b>demo</b></li>
        <li>or <b>pgdemo</b></li>
        <li>or <b>mydemo</b></li>
        <li>(or whatever alias you created)</li>
      </ul>
      <p><i>All existing data of the database will be lost!</i></p>
      
      <p>5. Create a DEMO database (optional)</p>
      <p>For testing you can fill in the database with some dummy data. If you don't need those later, 
        then you can create a blank database again according to the previous instructions.</p>

      <p><span style="color:#8B1A1A;font-weight:bold;">Sending Emails</span></p>
      <p>Configure your email settings in your <a 
        href="https://github.com/nervatura/nervatura/blob/master/app.yaml" 
        target="blank"><b>app.yaml</b></a> file:</p>
      <ul>
        <li><p>Sending Emails using SMTP (<a href="https://nodemailer.com/" 
            target="blank">Nodemailer</a>)</p>
          <p class="code" style="text-align: left;">
            SMTP_HOST: <b>YOUR_SMTP_HOST</b><br>
            SMTP_PORT: <b>YOUR_SMTP_PORT</b><br>
            SMTP_SECURE: <b>YOUR_SMTP_SECURE</b><br>
            SMTP_USER: <b>YOUR_SMTP_USER</b><br>
            SMTP_PASSWORD: <b>YOUR_SMTP_PASSWORD</b>
          </p></li>
        <li><p><a href="https://cloud.google.com/appengine/docs/flexible/nodejs/sending-emails-with-mailjet" 
            target="blank">Mailjet</a> settings, such as the API key and secret:</p>
          <p class="code" style="text-align: left;">
            MJ_APIKEY_PUBLIC: <b>YOUR_MJ_APIKEY_PUBLIC</b><br>
            MJ_APIKEY_PRIVATE: <b>YOUR_MJ_APIKEY_PRIVATE</b>
          </p>
        </li>
      </ul>
      
      <p><span style="color:#8B1A1A;font-weight:bold;">Configuring your App</span></p>
      <p>A Node.js App Engine application can be configured by a file named <a 
        href="https://github.com/nervatura/nervatura/blob/master/app.yaml" 
        target="blank"><b>app.yaml</b></a> that contains cpu, memory, network and disk resources, 
        automatic or manual scaling configurations, and general settings. Please see more:
      </p>
      <ul>
        <li><a href="https://cloud.google.com/appengine/docs/flexible/nodejs/configuring-your-app-with-app-yaml" 
          target="blank">Configuring your App with app.yaml</a></li>
        <li><a href="https://medium.com/google-cloud/scaling-google-app-engine-to-no-instances-or-maybe-just-1-37be4e8d4230" 
          target="blank">Scaling Google App Engine to No Instances (or maybe just 1)</a></li>
        <li><a href="https://medium.com/google-cloud/three-simple-steps-to-save-costs-when-prototyping-with-app-engine-flexible-environment-104fc6736495" 
          target="blank">Three Simple Steps to Save Costs when Prototyping with App Engine Flexible Environment</a></li>
        </ul>
      <p>Some example settings:</p>
      <p class="code" style="text-align: left;">
        automatic_scaling:<br>
        &nbsp;&nbsp;max_num_instances: 1<br>

        resources:<br>
        &nbsp;&nbsp;cpu: 1<br>
        &nbsp;&nbsp;memory_gb: 0.5<br>
        &nbsp;&nbsp;disk_size_gb: 10
      </p>

    </li>

    <li><b><a name="azure">Microsoft Azure</a></b>
      <p>If you don't have an Azure subscription, create a <a 
         href="https://azure.microsoft.com/free/" target="blank">free account</a> before 
         you begin. Install or upgrade the last version of the <a 
         href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli" 
         target="blank">Azure CLI 2.0</a>.<br>
         <a href="https://docs.microsoft.com/en-us/azure/app-service/scripts/app-service-cli-deploy-local-git" 
         target="blank">Create a web app</a> from a local Git repository.
      </p>
      <ul>
        <li>Create a resource group (see more <a 
          href="https://docs.microsoft.com/en-us/cli/azure/account?view=azure-cli-latest#az_account_list_locations" 
          target="blank">list-locations</a>):
          <p class="code" style="text-align: left;">
            $ az group create --location northeurope --name <b>[GROUP_NAME]</b>
          </p>
        </li>
        <li>Create an App Service plan (in FREE tier):
          <p class="code" style="text-align: left;">
            $ az appservice plan create --name <b>[PLAN_NAME]</b> --resource-group <b>[GROUP_NAME]</b> --sku FREE
          </p>
          Linux and Basic tier sample:
          <p class="code" style="text-align: left;">
            $ az appservice plan create --name <b>[PLAN_NAME]</b> --resource-group <b>[GROUP_NAME]</b> \<br />
            &nbsp;&nbsp;--is-linux --number-of-workers 3 --sku B1
          </p>
        </li>
        <li>Create a web app (see more <a 
          href="https://docs.microsoft.com/en-us/cli/azure/webapp?view=azure-cli-latest#az_webapp_list_runtimes" 
          target="blank">list-runtimes</a>):
          <p class="code" style="text-align: left;">
            $ az webapp create --name <b>[APP_NAME]</b> --resource-group <b>[GROUP_NAME]</b> --plan <b>[PLAN_NAME]</b> \<br />
            &nbsp;&nbsp;--deployment-local-git --runtime "node|8.1"
          </p>
        </li>
        <li>Set the account-level deployment credentials:
          <p class="code" style="text-align: left;">
            $ az webapp deployment user set --user-name <b>[USERNAME]</b> --password <b>[PASSWORD]</b>
          </p>
        </li>
        <li>Set some environment variables:
          <p class="code" style="text-align: left;">
            $ az webapp config appsettings set --resource-group <b>[GROUP_NAME]</b> --name <b>[APP_NAME]</b> \<br />
            &nbsp;&nbsp;--settings HOST_TYPE=azure
          </p>
        </li>
        <li>Disable the <a href="https://github.com/hengkiardo/express-enforces-ssl" 
          target="blank">SSL enforces</a> (optional, only for the FREE tier):
          <p class="code" style="text-align: left;">
            $ az webapp config appsettings set --resource-group <b>[GROUP_NAME]</b> --name <b>[APP_NAME]</b> \<br />
            &nbsp;&nbsp;--settings DISABLED_SSL=true
          </p>
        </li>
        <li>
          Clone and configure the (empty) local git directory:
          <p class="code" style="text-align: left;">
            $ git clone https://<b>[USERNAME]</b>@<b>[APP_NAME]</b>.scm.azurewebsites.net/<b>[APP_NAME]</b>.git
          </p>
          And upgrade to the latest Nervatura version (Linux sample):
          <p class="code" style="text-align: left;">
            $ git clone https://github.com/nervatura/nervatura.git nervatura_latest<br>
            $ rm -r <b>[APP_NAME]</b>/*<br>
            $ cp -r nervatura_latest/* <b>[APP_NAME]</b>/<br>
            $ cd <b>[APP_NAME]</b><br>
            $ git add .<br>
            $ git commit -a -m 'latest'<br>
            $ git push
          </p>
        </li>
        <li>Or all <a 
          href="https://docs.microsoft.com/en-us/azure/app-service/scripts/app-service-cli-deploy-github?toc=%2fcli%2fazure%2ftoc.json"
          target="_blank">in one step</a> (if you don't want to modify anything):
          <p class="code" style="text-align: left;">
            $ az webapp deployment source config --resource-group <b>[GROUP_NAME]</b> --name <b>[APP_NAME]</b> \<br />
            &nbsp;&nbsp;--repo-url https://github.com/nervatura/nervatura.git --branch master --manual-integration
          </p>
        </li>
      </ul>
      <p>See the web app here: http://<b>app_name</b>.azurewebsites.net</p>

      <p><span style="color:#8B1A1A;font-weight:bold;">Microsoft Azure Active Directory authentication (OpenID Connect)</span></p>
      <p>Login to the Azure Active Directory portal and register your app. See more here:</p>
      <ul>
        <li><a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-devquickstarts-openidconnect-nodejs" 
          target="blank">Node.js web app sign-in and sign-out with Azure AD</a></li>
        <li><a href="https://www.netiq.com/communities/cool-solutions/creating-application-client-id-client-secret-microsoft-azure-new-portal/" 
          target="blank">Creating the application Client ID and Client Secret from Microsoft Azure new portal</a></li>
      </ul>
      
      <p>Set the environment variables:</p>
      <p class="code" style="text-align: left;">
        $ az webapp config appsettings set --resource-group <b>[GROUP_NAME]</b> --name <b>[APP_NAME]</b> \<br />
        &nbsp;&nbsp;--settings AZURE_CLIENT_ID=<b>[YOUR_AZURE_CLIENT_ID]</b><br /><br />
        $ az webapp config appsettings set --resource-group <b>[GROUP_NAME]</b> --name <b>[APP_NAME]</b> \<br />
        &nbsp;&nbsp;--settings AZURE_CLIENT_SECRET=<b>[YOUR_AZURE_CLIENT_SECRET]</b><br /><br />
        $ az webapp config appsettings set --resource-group <b>[GROUP_NAME]</b> --name <b>[APP_NAME]</b> \<br />
        &nbsp;&nbsp;--settings AZURE_REDIRECT_URL=https://<b>[APP_NAME]</b>.azurewebsites.net/login/azure/callback<br /><br />
        $ az webapp config appsettings set --resource-group <b>[GROUP_NAME]</b> --name <b>[APP_NAME]</b> \<br />
        &nbsp;&nbsp;--settings AZURE_IDENTITY_URL=https://login.microsoftonline.com/<b>[YOUR_TENANT_NAME]</b>.onmicrosoft.com/v2.0/.well-known/openid-configuration
      </p>
      <p>1. Login to NAS Admin GUI</p>
      <ul>
        <li>Username: <b>admin</b></li>
        <li>Password: <b>leave the field empty, not needed</b> (Default. Please change after the first login!)</li>
      </ul>
      <p>2. Add a new user (User Accounts)</p>
      <ul>
        <li>Username: <b>a valid(!) Azure AD user</b></li>
        <li>Password: <b>leave the field empty, not needed</b></li>
      </ul>
      <p>3a. Remove the admin user (optional) and modify the following setting (Server Settings):</p>
      <ul>
        <li>Fieldname: <b>nas_auth</b></li>
        <li>Value: <b>azure</b></li>
      </ul>
      <p>3b. Or you can set the value at any time in an environment variable:</p>
      <p class="code" style="text-align: left;">
        $ az webapp config appsettings set --resource-group <b>[GROUP_NAME]</b> --name <b>[APP_NAME]</b> \<br />
        &nbsp;&nbsp;--settings NAS_AUTH=azure
      </p>
      <p>4. Log off and re-enter the new user.</p>

      <p><span style="color:#8B1A1A;font-weight:bold;">Databases support</span></p>
      <p><b>SQLite</b> install: Included by default. Recommended for testing only!</p>

      <p><b>MySQL in-app</b> feature:</p>
      <p>See more <a 
          href="https://blogs.msdn.microsoft.com/appserviceteam/2016/08/18/announcing-mysql-in-app-preview-for-web-apps/" 
          target="blank">Announcing MySQL in-app for Web Apps (Windows)</a></p>
      
      <p><b>MySQL</b> server:</p>
      <p>Create an Azure MySQL server.</p>
      <p class="code" style="text-align: left;">
        az mysql server create --resource-group <b>[GROUP_NAME]</b> --name <b>[SERVER_NAME]</b> \<br>
        &nbsp;&nbsp;--admin-user <b>[ADMIN_NAME]</b> --admin-password <b>[ADMIN_PASSWORD]</b> \<br>
        &nbsp;&nbsp;--performance-tier Basic --compute-units 50 --ssl-enforcement Disabled
      </p>
      <p>Configure a server-level firewall rule:</p>
      <p class="code" style="text-align: left;">
        az mysql server firewall-rule create --resource-group <b>[GROUP_NAME]</b> --server <b>[SERVER_NAME]</b> \<br>
        &nbsp;&nbsp;--name AllowYourIP --start-ip-address 0.0.0.0 --end-ip-address 255.255.255.255
      </p>
      <p>Create an empty database for MySQL server. Connect to your server using the mysql 
        command-line tool:</p>
      <p class="code" style="text-align: left;">
        $ mysql -h <b>[SERVER_NAME]</b>.mysql.database.azure.com -u <b>[ADMIN_NAME]</b>@<b>[SERVER_NAME]</b> -p<br /><br />
        mysql> CREATE DATABASE nervatura;
      </p>
      <p>Set some environment variables:</p>
      <p class="code" style="text-align: left;">
        $ az webapp config appsettings set --resource-group <b>[GROUP_NAME]</b> --name <b>[APP_NAME]</b> \<br />
        &nbsp;&nbsp;--settings AZURE_MYSQL_HOST=<b>[SERVER_NAME]</b>.mysql.database.azure.com<br /><br />
        $ az webapp config appsettings set --resource-group <b>[GROUP_NAME]</b> --name <b>[APP_NAME]</b> \<br />
        &nbsp;&nbsp;--settings AZURE_MYSQL_USERNAME=<b>[ADMIN_NAME]</b>@<b>[SERVER_NAME]</b><br /><br />
        $ az webapp config appsettings set --resource-group <b>[GROUP_NAME]</b> --name <b>[APP_NAME]</b> \<br />
        &nbsp;&nbsp;--settings AZURE_MYSQL_PASSWORD=<b>[ADMIN_PASSWORD]</b>
      </p>
      <p>Enable ssl enforcement when connect to server. (Optional.)</p>
      <p class="code" style="text-align: left;">
        $ az mysql server update --resource-group <b>[GROUP_NAME]</b> --name <b>[SERVER_NAME]</b> \<br />
        &nbsp;&nbsp;--ssl-enforcement Enabled<br /><br />
        $ az webapp config appsettings set --resource-group <b>[GROUP_NAME]</b> --name <b>[APP_NAME]</b> \<br />
        &nbsp;&nbsp;--settings MYSQL_SSL=true
      </p>
      <p>See more here: <a 
        href="https://docs.microsoft.com/en-us/azure/mysql/quickstart-create-mysql-server-database-using-azure-cli" 
        target="blank">Create an Azure Database for MySQL server using Azure CLI</a></p>

      <p><b>PostgeSQL</b> server:</p>
      <p>Create an Azure PostgreSQL server. By default, <b>postgres</b> database 
        gets created under your server.</p>
      <p class="code" style="text-align: left;">
        $ az postgres server create --resource-group <b>[GROUP_NAME]</b> --name <b>[SERVER_NAME]</b> \<br>
        &nbsp;&nbsp;--admin-user <b>[ADMIN_NAME]</b> --admin-password <b>[ADMIN_PASSWORD]</b> \<br>
        &nbsp;&nbsp;--performance-tier Basic --version 9.6 --ssl-enforcement Disabled
      </p>
      <p>Configure a server-level firewall rule:</p>
      <p class="code" style="text-align: left;">
        $ az postgres server firewall-rule create --resource-group <b>[GROUP_NAME]</b> --server <b>[SERVER_NAME]</b> \<br>
        &nbsp;&nbsp;--name AllowAllIps --start-ip-address 0.0.0.0 --end-ip-address 255.255.255.255
      </p>
      <p>Set some environment variables:</p>
      <p class="code" style="text-align: left;">
        $ az webapp config appsettings set --resource-group <b>[GROUP_NAME]</b> --name <b>[APP_NAME]</b> \<br />
        &nbsp;&nbsp;--settings AZURE_PG_HOST=<b>[SERVER_NAME]</b>.postgres.database.azure.com<br /><br />
        $ az webapp config appsettings set --resource-group <b>[GROUP_NAME]</b> --name <b>[APP_NAME]</b> \<br />
        &nbsp;&nbsp;--settings AZURE_PG_USERNAME=<b>[ADMIN_NAME]</b>@<b>[SERVER_NAME]</b><br /><br />
        $ az webapp config appsettings set --resource-group <b>[GROUP_NAME]</b> --name <b>[APP_NAME]</b> \<br />
        &nbsp;&nbsp;--settings AZURE_PG_PASSWORD=<b>[ADMIN_PASSWORD]</b>
      </p>
      <p>Enable ssl enforcement when connect to server. (Optional. If you're getting error 
        after receiving response from database: <a 
        href="https://github.com/brianc/node-postgres/issues/1344" 
        target="blank">ECONNRESET with unpooled connection</a>)</p>
      <p class="code" style="text-align: left;">
        $ az postgres server update --resource-group <b>[GROUP_NAME]</b> --name <b>[SERVER_NAME]</b> \<br />
        &nbsp;&nbsp;--ssl-enforcement Enabled<br /><br />
        $ az webapp config appsettings set --resource-group <b>[GROUP_NAME]</b> --name <b>[APP_NAME]</b> \<br />
        &nbsp;&nbsp;--settings PGSSLMODE=require
      </p>
      <p>See more here: <a 
        href="https://docs.microsoft.com/en-us/azure/postgresql/quickstart-create-server-database-azure-cli" 
        target="blank">Create an Azure Database for PostgreSQL using the Azure CLI</a></p>
      
      <p><b>Azure SQL</b> database:</p>
      <p>Create a logical server and a single Azure SQL database (see more <a 
        href="https://docs.microsoft.com/en-us/cli/azure/account?view=azure-cli-latest#az_account_list_locations" 
        target="blank">list-locations</a>):</p>
      <p class="code" style="text-align: left;">
        $ az sql server create --resource-group <b>[GROUP_NAME]</b> --name <b>[SERVER_NAME]</b> \<br> 
        &nbsp;&nbsp;--location northeurope --admin-user <b>[ADMIN_NAME]</b> --admin-password <b>[ADMIN_PASSWORD]</b><br><br>
        $ az sql db create --resource-group <b>[GROUP_NAME]</b> --server <b>[SERVER_NAME]</b> \<br>
        &nbsp;&nbsp;--name nervatura --service-objective B0<br><br>
      </p>
      <p>Configure a server-level firewall rule:</p>
      <p class="code" style="text-align: left;">
        $ az sql server firewall-rule create --resource-group <b>[GROUP_NAME]</b> --server <b>[SERVER_NAME]</b> \<br>
        &nbsp;&nbsp;--name AllowAllIps --start-ip-address 0.0.0.0 --end-ip-address 255.255.255.255
      </p>
      <p>Set some environment variables:</p>
      <p class="code" style="text-align: left;">
        $ az webapp config appsettings set --resource-group <b>[GROUP_NAME]</b> --name <b>[APP_NAME]</b> \<br />
        &nbsp;&nbsp;--settings MSSQL_ENCRYPT=true<br /><br />
        $ az webapp config appsettings set --resource-group <b>[GROUP_NAME]</b> --name <b>[APP_NAME]</b> \<br />
        &nbsp;&nbsp;--settings AZURE_SQL_HOST=<b>[SERVER_NAME]</b>.database.windows.net<br /><br />
        $ az webapp config appsettings set --resource-group <b>[GROUP_NAME]</b> --name <b>[APP_NAME]</b> \<br />
        &nbsp;&nbsp;--settings AZURE_SQL_USERNAME=<b>[ADMIN_NAME]</b>@<b>[SERVER_NAME]</b><br /><br />
        $ az webapp config appsettings set --resource-group <b>[GROUP_NAME]</b> --name <b>[APP_NAME]</b> \<br />
        &nbsp;&nbsp;--settings AZURE_SQL_PASSWORD=<b>[ADMIN_PASSWORD]</b>
      </p>
      <p>See more here: <a 
        href="https://docs.microsoft.com/en-us/azure/sql-database/sql-database-get-started-cli" 
        target="blank">Create a single Azure SQL database using the Azure CLI</a></p>

      <p><span style="color:#8B1A1A;font-weight:bold;">Create a new Nervatura database</span></p>
      <p>1. Login to NAS Admin GUI</p>
      <p>2. Add/Edit a new customer database reference</p>
      <p>3.1 NAS SQLite database settings (optional)</p>
      <ul>
        <li>Alias: <b>demo</b> (or what you prefer)</li>
        <li>Engine: <b>SQLite</b></li>
        <li>Host: <b>leave the field empty, not needed</b></li>
        <li>Port: <b>leave the field empty, not needed</b></li>
        <li>Database: <b>demo</b> (or what you prefer)</li>
        <li>Other settings: <b>default</b> (or what you prefer)</li>
      </ul>
      <p><i>You can create an unlimited number of SQLite databases. Recommended for testing only!</i></p>

      <p>3.2 NAS MySQL in-app database settings (optional)</p>
      <ul>
        <li>Alias: <b>lcdemo</b> (or what you prefer)</li>
        <li>Engine: <b>MySQL</b></li>
        <li>Host: <b>$MYSQLCONNSTR_localdb</b></li>
        <li>Port: <b>leave the field empty, not needed</b></li>
        <li>Database: <b>localdb</b></li>
        <li>UserName: <b>leave the field empty, not needed</b></li>
        <li>Password: <b>leave the field empty, not needed</b></li>
        <li>Other settings: <b>default</b> (or what you prefer)</li>
      </ul>
      
      <p>3.3 NAS MySQL database settings (optional)</p>
      <ul>
        <li>Alias: <b>mydemo</b> (or what you prefer)</li>
        <li>Engine: <b>MySQL</b></li>
        <li>Host: <b>$AZURE_MYSQL_HOST</b></li>
        <li>Port: <b>3306</b></li>
        <li>Database: <b>nervatura</b> (or what you prefer)</li>
        <li>UserName: <b>$AZURE_MYSQL_USERNAME</b></li>
        <li>Password: <b>$AZURE_MYSQL_PASSWORD</b></li>
        <li>Other settings: <b>default</b> (or what you prefer)</li>
      </ul>
      
      <p>3.4. NAS PostgreSql database settings (optional)</p>
      <ul>
        <li>Alias: <b>pgdemo</b> (or what you prefer)</li>
        <li>Engine: <b>PostgreSQL</b></li>
        <li>Host: <b>$AZURE_PG_HOST</b></li>
        <li>Port: <b>5432</b></li>
        <li>Database: <b>postgres</b></li>
        <li>UserName: <b>$AZURE_PG_USERNAME</b></li>
        <li>Password: <b>$AZURE_PG_PASSWORD</b></li>
        <li>Other settings: <b>default</b> (or what you prefer)</li>
      </ul>

      <p>3.5. NAS Azure SQL database settings (optional)</p>
      <ul>
        <li>Alias: <b>msdemo</b> (or what you prefer)</li>
        <li>Engine: <b>MSSQL</b></li>
        <li>Host: <b>$AZURE_SQL_HOST</b></li>
        <li>Port: <b>1433</b></li>
        <li>Database: <b>nervatura</b></li>
        <li>UserName: <b>$AZURE_SQL_USERNAME</b></li>
        <li>Password: <b>$AZURE_SQL_PASSWORD</b></li>
        <li>Other settings: <b>default</b> (or what you prefer)</li>
      </ul>

      <p>4. Create a new Nervatura database</p>
      <p>Database alias:</p>
      <ul>
        <li><b>demo</b></li>
        <li>or <b>lcdemo</b></li>
        <li>or <b>mydemo</b></li>
        <li>or <b>pgdemo</b></li>
        <li>or <b>msdemo</b></li>
        <li>(or whatever alias you created)</li>
      </ul>
      <p><i>All existing data of the database will be lost!</i></p>
      
      <p>5. Create a DEMO database (optional)</p>
      <p>For testing you can fill in the database with some dummy data. If you don't need those later, 
        then you can create a blank database again according to the previous instructions.</p>

      <p><span style="color:#8B1A1A;font-weight:bold;">Sending Emails</span></p>
      <p>Configure your email settings in your application environment variables:</p>
      <ul>
        <li><p>Sending Emails using SMTP (<a href="https://nodemailer.com/" 
            target="blank">Nodemailer</a>)</p>
          <p class="code" style="text-align: left;">
            $ az webapp config appsettings set --resource-group <b>[GROUP_NAME]</b> --name <b>[APP_NAME]</b> \<br />
            &nbsp;&nbsp;--settings SMTP_HOST=<b>[YOUR_SMTP_HOST]</b><br /><br />
            $ az webapp config appsettings set --resource-group <b>[GROUP_NAME]</b> --name <b>[APP_NAME]</b> \<br />
            &nbsp;&nbsp;--settings SMTP_PORT=<b>[YOUR_SMTP_PORT]</b><br /><br />
            $ az webapp config appsettings set --resource-group <b>[GROUP_NAME]</b> --name <b>[APP_NAME]</b> \<br />
            &nbsp;&nbsp;--settings SMTP_SECURE=<b>[YOUR_SMTP_SECURE]</b><br /><br />
            $ az webapp config appsettings set --resource-group <b>[GROUP_NAME]</b> --name <b>[APP_NAME]</b> \<br />
            &nbsp;&nbsp;--settings SMTP_USER=<b>[YOUR_SMTP_USER]</b><br /><br />
            $ az webapp config appsettings set --resource-group <b>[GROUP_NAME]</b> --name <b>[APP_NAME]</b> \<br />
            &nbsp;&nbsp;--settings SMTP_PASSWORD=<b>[YOUR_SMTP_PASSWORD]</b>
          </p></li>
        <li><p><a href="https://cloud.google.com/appengine/docs/flexible/nodejs/sending-emails-with-mailjet" 
            target="blank">Mailjet</a> settings, such as the API key and secret:</p>
          <p class="code" style="text-align: left;">
            $ az webapp config appsettings set --resource-group <b>[GROUP_NAME]</b> --name <b>[APP_NAME]</b> \<br />
            &nbsp;&nbsp;--settings MJ_APIKEY_PUBLIC=<b>[YOUR_MJ_APIKEY_PUBLIC]</b><br /><br />
            $ az webapp config appsettings set --resource-group <b>[GROUP_NAME]</b> --name <b>[APP_NAME]</b> \<br />
            &nbsp;&nbsp;--settings MJ_APIKEY_PRIVATE=<b>[YOUR_MJ_APIKEY_PRIVATE]</b>
          </p>
        </li>
      </ul>

    </li>

    <li><b><a name="cloud_openshift">OpenShift</a></b>
      <p>Login at <a href="http://openshift.redhat.com/" target="blank">OpenShift</a>. 
         Create an account if you don’t already have one.<br>
         Ensure you have the latest version of the 
         <a href="https://developers.openshift.com/getting-started/" target="blank">client tools</a>. 
         As part of this process, you’ll run the rhc setup command and choose a unique name 
         (called a namespace) that becomes part of your public application URL.
         </p>
      <p>Create a <b>nervatura</b> (scaled) application (you can call your application whatever you want) 
        on OpenShift with the following command:</p>
      <p class="code" style="text-align: left;">
        $ rhc app create nervatura nodejs --scaling --from-code=https://github.com/nervatura/nervatura.git<br>
      </p>
      <p>This package includes 
        <a href="https://github.com/ramr/nodejs-custom-version-openshift" target="_blank">a dynamic Node.js build stage</a> 
        that will provide the application with a customized Node.js runtime. The version of Node that is 
        available will depend on the requirements listed in the application's package.json file.</p>
      <p>See: <span class="code">.openshift/action_hooks/</span> for more informaiton on how the OpenShift build process works.</p>
      <p>That's it, you can now checkout your application at: https://nervatura-<b><i>yournamespace</i></b>.rhcloud.com</p>
      
      <p><span style="color:#8B1A1A;font-weight:bold;">Databases support</span></p>
      <p><b>SQLite</b> install: Included by default. Database files are stored in 
      <a href="https://developers.openshift.com/managing-your-applications/filesystem.html" target="blank">a separate data directory</a>, 
        independently from the application. Upgrade of the application does not affect the content of the database files. 
        Several database files can be created.</p>
      <p><b>PostgeSQL</b> install:</p>
      <p class="code" style="text-align: left;">
        rhc cartridge add postgresql-9.2 -a nervatura
      </p>
      <p><b>MySQL</b> install:</p>
      <p class="code" style="text-align: left;">
        rhc cartridge add mysql-5.5 -a nervatura
      </p>
      
      <p><span style="color:#8B1A1A;font-weight:bold;">Create a new Nervatura database</span></p>
      <p>1. Login to NAS Admin GUI</p>
      <ul>
        <li>Username: <b>admin</b></li>
        <li>Password: <b>leave the field empty, not needed</b> (Default. Please change after the first login!)</li>
      </ul>
      <p>2. Add/Edit a new customer database reference</p>
      <p>3.1 NAS SQLite database settings (optional)</p>
      <ul>
        <li>Alias: <b>demo</b> (or what you prefer)</li>
        <li>Engine: <b>SQLite</b></li>
        <li>Host: <b>leave the field empty, not needed</b></li>
        <li>Port: <b>leave the field empty, not needed</b></li>
        <li>Database: <b>demo</b> (or what you prefer)</li>
        <li>Other settings: <b>default</b> (or what you prefer)</li>
      </ul>
      <p><i>You can create an unlimited number of SQLite databases (to max. storage/gear)!</i></p>
      
      <p>3.2. NAS PostgreSql database settings (optional)</p>
      <ul>
        <li>Alias: <b>pgdemo</b> (or what you prefer)</li>
        <li>Engine: <b>PostgreSQL</b></li>
        <li>Host: <b>$OPENSHIFT_POSTGRESQL_DB_HOST</b></li>
        <li>Port: <b>$OPENSHIFT_POSTGRESQL_DB_PORT</b></li>
        <li>Database: <b>$OPENSHIFT_APP_NAME</b></li>
        <li>UserName: <b>$OPENSHIFT_POSTGRESQL_DB_USERNAME</b></li>
        <li>Password: <b>$OPENSHIFT_POSTGRESQL_DB_PASSWORD</b></li>
        <li>Other settings: <b>default</b> (or what you prefer)</li>
      </ul>
      <p><i>For each application you can configure only one postgresql database! (OpenShift restriction)</i></p>
      
      <p>3.3 NAS MySQL database settings (optional)</p>
      <ul>
        <li>Alias: <b>mydemo</b> (or what you prefer)</li>
        <li>Engine: <b>MySQL</b></li>
        <li>Host: <b>$OPENSHIFT_MYSQL_DB_HOST</b></li>
        <li>Port: <b>$OPENSHIFT_MYSQL_DB_PORT</b></li>
        <li>Database: <b>$OPENSHIFT_APP_NAME</b></li>
        <li>UserName: <b>$OPENSHIFT_MYSQL_DB_USERNAME</b></li>
        <li>Password: <b>$OPENSHIFT_MYSQL_DB_PASSWORD</b></li>
        <li>Other settings: <b>default</b> (or what you prefer)</li>
      </ul>
      <p><i>For each application you can configure only one mysql database! (OpenShift restriction)</i></p>
      
      <p>4. Create a new Nervatura database</p>
      <p>Database alias:</p>
      <ul>
        <li><b>demo</b></li>
        <li>or <b>pgdemo</b></li>
        <li>or <b>mydemo</b></li>
        <li>(or whatever alias you created)</li>
      </ul>
      <p><i>All existing data of the database will be lost!</i></p>
      
      <p>5. Create a DEMO database (optional)</p>
      <p>For testing you can fill in the database with some dummy data. If you don't need those later, 
        then you can create a blank database again according to the previous instructions.</p>
        
      <p><span style="color:#8B1A1A;font-weight:bold;">Managing an OpenShift Application</span></p>
      
      <p>Upgrade to the latest Nervatura version (Linux)</p>
      <p class="code" style="text-align: left;">
        rhc git-clone -a nervatura<br>
        git clone https://github.com/nervatura/nervatura.git nervatura_latest<br>
        rm -r nervatura/*<br>
        cp -r nervatura_latest/* nervatura/<br>
        cd nervatura<br>
        git add .<br>
        git commit -a -m 'latest'<br>
        git push
      </p>
      
      <p>Save and restore backups</p>
      <p class="code" style="text-align: left;">
        rhc snapshot-save -a nervatura<br>
        rhc snapshot-restore -f nervatura.tar.gz
      </p>
      
      <p>Watching logs</p>
      <p class="code" style="text-align: left;">
        rhc tail -a nervatura
      </p>
      
      <p>Starts and stops an application</p>
      <p class="code" style="text-align: left;">
        rhc app-start -a nervatura<br>
        rhc app-stop -a nervatura<br>
        rhc app-force-stop -a nervatura<br>
        rhc app-restart -a nervatura<br>
      </p>
      
      <p>Deletes all the contents of the log and /tmp directory</p>
      <p class="code" style="text-align: left;">
        rhc app-tidy -a nervatura
      </p>
      
      <p>Copies a new Nervatura Report template file to the database install directory</p>
      <p class="code" style="text-align: left;">
        rhc scp demo upload custom_report.xml app-root/runtime/repo/public/report/
      </p>
    </li>
    <li><b><a name="cloud_docker">Docker</a></b>
      <p><a href="https://www.docker.com/what-docker" target="_blank">Docker</a> allows you to 
        package an application with all of its dependencies into a standardized unit for software 
        development. Get Started with Docker Engine for 
        <a href="https://docs.docker.com/linux/" target="_blank">Linux</a>, 
        <a href="https://docs.docker.com/windows/" target="_blank">Windows</a> or 
        <a href="https://docs.docker.com/mac/" target="_blank">Mac OS X</a>.</p>
      
      <p><span style="color:#8B1A1A;font-weight:bold;">What's in this image?</span></p>
      <ul>
        <li>A minimal Docker image 
          <a href="https://hub.docker.com/_/alpine/" target="_blank">based on Alpine Linux</a> 
          (Official Repository)</li>
        <li>Additional packages: nodejs, python(2.7), git</li>
        <li><a href="https://docs.docker.com/docker-hub/builds/" 
          target="_blank">Automated Build</a> from the 
          <a href="https://github.com/nervatura/nervatura" 
          target="_blank">Nervatura GitHub</a> repository (see <a 
          href="https://raw.githubusercontent.com/nervatura/nervatura/master/Dockerfile" 
          target="_blank">this Dockerfile</a>)</li>
        <li>Node production packages (<a 
          href="https://raw.githubusercontent.com/nervatura/nervatura/master/package.json" 
          target="_blank">dependencies+optionalDependencies</a>)</li>
        <li><a href="http://pm2.keymetrics.io/" 
          target="_blank">pm2 process manager</a></li>
      </ul>
      
      <p><span style="color:#8B1A1A;font-weight:bold;">Creates a new Nervatura container</span></p>
      <p style="margin:0px;">1. Sample production settings:</p>
      <ul>
        <li>production mode, enforces HTTPS connections, publish port:8080</li>
        <li>pm2 process manage start</li>
        <li>automatically remove the container when it exits: run --rm</li>
        <li>mount a persist host directory as a data volume (host mountpoint: docker volume inspect nervatura)</li>
        <li>add link to postgres database (see more Databases support)</li>
      </ul>
      <p class="code" style="text-align: left;">
        docker run --rm -i -t -p 8080:8080 \<br>
        &nbsp;&nbsp;-v nervatura:/app/data -w /app/dist\<br>
        &nbsp;&nbsp;-e NERVATURA_DATA_DIR=/app/data \<br>
        &nbsp;&nbsp;--link postgres \<br>
        &nbsp;&nbsp;--name nervatura nervatura/nervatura:latest \<br>
        &nbsp;&nbsp;pm2 start -x server.js --max-memory-restart 150M --no-daemon
      </p>
      
      <p style="margin:0px;">2. Sample development settings:</p>
      <ul>
        <li>development mode, HTTP connections, publish port:8080</li>
        <li>automatically remove the container when it exits: run --rm</li>
        <li>mount a persist host directory as a data volume 
          (host mountpoint: <span class="code">docker volume inspect nervatura</span>)</li>
        <li>remote ('bridge' network) database (see more Databases support)</li>
      </ul>
      <p class="code" style="text-align: left;">
        docker run --rm -i -t -p 8080:8080 \<br>
        &nbsp;&nbsp;-v nervatura:/app/data -w /app/dist \<br>
        &nbsp;&nbsp;-e NODE_ENV=development -e NERVATURA_DATA_DIR=/app/data \<br>
        &nbsp;&nbsp;--name nervatura nervatura/nervatura:latest \<br>
        &nbsp;&nbsp;node server.js
      </p>
      
      <p style="margin:0px;">3. Sample development settings:</p>
      <ul>
        <li>development mode, HTTP connections, publish ports:8080,5858</li>
        <li>mount the source directory: you are free to debug and modify the code</li>
        <li>automatically remove the container when it exits: run --rm</li>
        <li>mount a persist host directory as a data volume 
          (host mountpoint: <span class="code">docker volume inspect nervatura</span>)</li>
        <li>add link to mysql database (see more Databases support)</li>
      </ul>
      <p class="code" style="text-align: left;">
        git clone https://github.com/nervatura/nervatura.git<br>
        cd nervatura<br>
        docker run --rm -i -t -p 8080:8080 -p 5858:5858 \<br>
        &nbsp;&nbsp;-v nervatura:/app/data -v `pwd`:/app/src -w /app/src \<br>
        &nbsp;&nbsp;-e NODE_ENV=development -e NERVATURA_DATA_DIR=/app/data \<br>
        &nbsp;&nbsp;--link mysql \<br>
        &nbsp;&nbsp;--name nervatura nervatura/nervatura:latest \<br>
        &nbsp;&nbsp;node --debug=5858 server.js
      </p>
      
      <p><span style="color:#8B1A1A;font-weight:bold;">Databases support</span></p>
      <p><b>SQLite</b> install: Included by default. Database files are stored in 
      <a href="https://docs.docker.com/engine/userguide/containers/dockervolumes/" target="blank">a separate data volume</a>, 
        independently from the application. Upgrade of the application does not affect the content of the database files. 
        Several database files can be created.</p>
      <p><b>PostgeSQL</b> install:</p>
      <p class="code" style="text-align: left;">
        docker create -i -t -p 5432:5432 \<br>
        &nbsp;&nbsp;-v pgdata:/var/lib/postgresql/data \<br>
        &nbsp;&nbsp;-e POSTGRES_USER=postgres -e POSTGRES_PASSWORD=admin -e POSTGRES_DB=nervatura \<br>
        &nbsp;&nbsp;--restart="always" --name postgres postgres<br>
        docker start postgres
      </p>
      <p><b>MySQL</b> install:</p>
      <p class="code" style="text-align: left;">
        docker create -i -t -p 3306:3306 \<br>
        &nbsp;&nbsp;-v mysql:/var/lib/mysql \<br>
        &nbsp;&nbsp;-e MYSQL_USER=nervatura -e MYSQL_PASSWORD=admin -e MYSQL_ROOT_PASSWORD=admin -e MYSQL_DATABASE=nervatura \<br>
        &nbsp;&nbsp;--restart="always" --name mysql mysql<br>
        docker start mysql
      </p>
      <p><b>MSSQL</b> install:</p>
      <p class="code" style="text-align: left;">
        docker create -i -t -p 1433:1433 \<br>
        &nbsp;&nbsp;-v mssql:/var/lib/mssql/data \<br>
        &nbsp;&nbsp;-e 'ACCEPT_EULA=Y' -e 'SA_PASSWORD=SA_admin' \<br>
        &nbsp;&nbsp;--restart="always" --name mssql microsoft/mssql-server-linux<br><br>
        docker exec -it mssql "bash"<br>
        /opt/mssql-tools/bin/sqlcmd -S localhost -U SA -P 'SA_admin'<br>
        CREATE DATABASE nervatura;<br>
        GO<br>
        QUIT<br>
        exit<br><br>
        docker start mysql
      </p>
      <p><b>Remote</b> database:</p> 
      <p>See more docker run <a 
        href="https://docs.docker.com/engine/reference/commandline/run/" target="_blank">--net parameter</a></p>
      
      <p><span style="color:#8B1A1A;font-weight:bold;">Create a new Nervatura database</span></p>
      <p>1. Login to NAS Admin GUI</p>
      <ul>
        <li>Username: <b>admin</b></li>
        <li>Password: <b>leave the field empty, not needed</b> (Default. Please change after the first login!)</li>
      </ul>
      <p>2. Add/Edit a new customer database reference</p>
      <p>3.1 NAS SQLite database settings (optional)</p>
      <ul>
        <li>Alias: <b>demo</b> (or what you prefer)</li>
        <li>Engine: <b>SQLite</b></li>
        <li>Host: <b>leave the field empty, not needed</b></li>
        <li>Port: <b>leave the field empty, not needed</b></li>
        <li>Database: <b>demo</b> (or what you prefer)</li>
        <li>Other settings: <b>default</b> (or what you prefer)</li>
      </ul>
      <p><i>You can create an unlimited number of SQLite databases!</i></p>
      
      <p>3.2. NAS PostgreSql database settings (optional)</p>
      <ul>
        <li>Alias: <b>pgdemo</b> (or what you prefer)</li>
        <li>Engine: <b>PostgreSQL</b></li>
        <li>Host: <b>$POSTGRES_PORT_5432_TCP_ADDR</b></li>
        <li>Port: <b>$POSTGRES_PORT_5432_TCP_PORT</b></li>
        <li>Database: <b>$POSTGRES_ENV_POSTGRES_DB</b> (or what you prefer)</li>
        <li>UserName: <b>$POSTGRES_ENV_POSTGRES_USER</b></li>
        <li>Password: <b>$POSTGRES_ENV_POSTGRES_PASSWORD</b></li>
        <li>Other settings: <b>default</b> (or what you prefer)</li>
      </ul>
      <p><i>You can create an unlimited number of PostgreSql databases! 
        POSTGRES_DB optional environment variable can be used to define a 
        different name for the default database that is created when the 
        image is first started. If it is not specified, then the value of 
        POSTGRES_USER will be used.</i></p>
      
      <p>3.3 NAS MySQL database settings (optional)</p>
      <ul>
        <li>Alias: <b>mydemo</b> (or what you prefer)</li>
        <li>Engine: <b>MySQL</b></li>
        <li>Host: <b>$MYSQL_PORT_3306_TCP_ADDR</b></li>
        <li>Port: <b>$MYSQL_PORT_3306_TCP_PORT</b></li>
        <li>Database: <b>$MYSQL_ENV_MYSQL_DATABASE</b> (or what you prefer)</li>
        <li>UserName: <b>$MYSQL_ENV_MYSQL_USER</b> (or root)</li>
        <li>Password: <b>$MYSQL_ENV_MYSQL_PASSWORD</b> (or $MYSQL_ROOT_PASSWORD)</li>
        <li>Other settings: <b>default</b> (or what you prefer)</li>
      </ul>
      <p><i>You can create an unlimited number of MySQL databases! 
        MYSQL_DATABASE variable is optional and allows you to specify 
        the name of a database to be created on image startup. If a 
        user/password was supplied then that user will be granted 
        superuser access (corresponding to GRANT ALL) to this database.</i></p>
      
      <p>3.4 NAS MSSQL database settings (optional)</p>
      <ul>
        <li>Alias: <b>msdemo</b> (or what you prefer)</li>
        <li>Engine: <b>MSSQL</b></li>
        <li>Host: <b>$MSSQL_PORT_1433_TCP_ADDR</b></li>
        <li>Port: <b>$MSSQL_PORT_1433_TCP_PORT</b></li>
        <li>Database: <b>nervatura</b> (or what you prefer)</li>
        <li>UserName: <b>sa</b> (or what you prefer)</li>
        <li>Password: <b>$MSSQL_ENV_SA_PASSWORD</b></li>
        <li>Other settings: <b>default</b> (or what you prefer)</li>
      </ul>
      <p><i>You can create an unlimited number of MSSQL databases!</i></p>
      
      <p>3.5 Remote database settings (optional)</p>
      <ul>
        <li>Alias: <b>msdemo</b> (or what you prefer)</li>
        <li>Engine: <b>MSSQL</b> (or what you prefer)</li>
        <li>Host: <b>192.168.56.1</b> (or what you prefer)</li>
        <li>Port: <b>1433</b> (or what you prefer)</li>
        <li>Database: <b>nervatura</b> (or what you prefer)</li>
        <li>UserName: <b>sa</b> (or what you prefer))</li>
        <li>Password: <b>sadmin</b> (or what you prefer)</li>
        <li>Other settings: <b>default</b> (or what you prefer)</li>
      </ul>
      <p><i>You can create an unlimited number of remote databases! 
        See more docker run <a 
        href="https://docs.docker.com/engine/reference/commandline/run/" 
        target="_blank">--net parameter</a></i></p>
        
      <p>4. Create a new Nervatura database</p>
      <p>Database alias:</p>
      <ul>
        <li><b>demo</b></li>
        <li>or <b>pgdemo</b></li>
        <li>or <b>mydemo</b></li>
        <li>or <b>msdemo</b></li>
        <li>(or whatever alias you created)</li>
      </ul>
      <p><i>All existing data of the database will be lost!</i></p>
      
      <p>5. Create a DEMO database (optional)</p>
      <p>For testing you can fill in the database with some dummy data. If you don't need those later, 
        than you can create a blank database again according to the previous instructions.</p>
      
      <p><span style="color:#8B1A1A;font-weight:bold;">Managing an Docker Application</span></p>
      <p><a href="https://docs.docker.com/engine/userguide/intro/" 
        target="blank">Engine user guide</a></p>
      
      <p><span style="color:#8B1A1A;font-weight:bold;">Docker Cloud</span></p>
      <p style="margin:0px;"><a href="https://docs.docker.com/docker-cloud/overview/" 
        target="blank">Docker Cloud</a> service providers:</p>
      <ul>
        <li><a href="https://docs.docker.com/docker-cloud/infrastructure/link-aws/" 
          target="blank">Amazon Web Services</a></li>
        <li><a href="https://docs.docker.com/docker-cloud/infrastructure/link-do/" 
          target="blank">DigitalOcean</a></li>
        <li><a href="https://docs.docker.com/docker-cloud/infrastructure/link-azure/" 
          target="blank">Microsoft Azure</a></li>
        <li><a href="https://docs.docker.com/docker-cloud/infrastructure/link-softlayer/" 
          target="blank">IBM SoftLayer</a></li>
        <li><a href="https://docs.docker.com/docker-cloud/infrastructure/link-packet/" 
          target="blank">Packet.net</a></li>
      </ul>
      <p>Google Container Engine: <a href="http://kubernetes.io/" target="blank">kubernetes</a></p>
    </li>
  </ul>
  
  <h3>
		<a name="config">3. Server config</a>
	</h3>
  <p>Application const and UI/GUI settings: 
    <a href="https://github.com/nervatura/nervatura/blob/master/lib/node/conf.js" 
    target="blank">lib/node/conf.js</a> file. Can be changed, but the program is 
    overwritten when updated!</p>
  
  <ul>
    <li><i>start_page</i>: String.
      <ul style="padding-left:15px;">
        <li>ntura: Default.</li>
        <li>static: Custom static homepage</li>
        <li>custom: Custom NodeJS/Express homepage</li>
      </ul>
    </li>
    <li><i>data_dir</i>: Path string. Default:app_home/data or OPENSHIFT_DATA_DIR. A persistent data directory. Subfolders: database(sqlite), data(export/import), storage.</li>
    <li><i>data_store</i>: String.
      <ul style="padding-left:15px;">
        <li>lokijs: Default.</li>
        <li>pouchdb</li>
        <li>datastore: Google Datastore (Google App Engine default)</li>
      </ul>
    </li>
    <li><i>email_providers</i>: Object. Email Service Providers
      <ul style="padding-left:15px;">
        <li>smtp: <a href="https://nodemailer.com/smtp/" 
          target="blank">nodemailer</a> smtp options</li>
        <li><a href="https://github.com/mailjet/mailjet-apiv3-nodejs" 
          target="blank">mailjet</a>: clientID, clientSecret</li>
      </ul>
    </li>
    <li><i>engine</i>: Array. Valid values: sqlite, mysql, postgres, mssql</li>
    <li><i>nas_login</i>: Object. NAS Admin authentications
      <ul style="padding-left:15px;">
        <li>local</li>
        <li>google</li>
      </ul>
    </li>
    <li><i>pool_config</i>: See more <a href="https://github.com/grncdr/node-any-db-pool#api" target="blank">database agnostic connection pool</a></li>
    <li><i>python_script</i>: Path string. Default:'./lib/pylib'. The path where to look for Python 2 app. scripts.</li>
    <li><i>lang</i>: String. Default value: 'en'. Valid values: en.</li>
    <li><i>enforces_ssl</i>: This setting enforces HTTPS connections on any incoming requests in production 
      mode. Default true. See more <a href="https://github.com/hengkiardo/express-enforces-ssl" 
      target="blank">express-enforces-ssl</a></li>
    <li><i>pg_ssl</i>: Enable postgres ssl enforcement or not when connect to server. Default false.</li>
    <li><i>mysql_ssl</i>: Enable mysql ssl enforcement or not when connect to server. Default false.</li>
  </ul>
  
  <p>Initial setup (conf.js) and persistent server-side settings: data_dir/storage/data(.json)</p>
  
  <ul>
    <li><i>databases</i>: Default sample customer database connection settings. See more NAS Admin GUI/Customer Databases.
      <ul style="padding-left:15px;">
        <li><i>alias</i>: a unique connection name</li>
        <li><i>engine</i>: the type of database</li>
        <li><i>host, port, dbname, username, password</i>: the connection information (stored encrypted)</li>
        <li><i>ndi_enabled</i>: enables the NDI</li>
        <li><i>encrypt_password</i>: encrypting the data of NDI (cipher key)</li>
        <li><i>dbs_host_restriction</i>: limiting database connections(ip pattern)</li>
      </ul>
    </li>
    <li><i>databases_docker</i>: Default sample customer database settings (Docker).</li>
    <li><i>databases_gae</i>: Default sample customer database settings (Google App Engine).</li>
    <li><i>databases_openshift</i>: Default sample customer database settings (OpenShift service).</li>
    <li><i>users</i>: Default sample user accounts. See more NAS Admin GUI/User Accounts.</li>
    <li><i>settings</i>: See more NAS Admin GUI/Server Settings. A restart is required!
      <ul style="padding-left:15px;">
        <li><i>nas_auth</i>: NAS Admin authentication strategy. Default:'local'. Valid values: 
          local (username and password), azure (Azure AD OpenID Connect), google (Google OAuth 2.0)</li>
        <li><i>python2_path</i>: Path string. Default:'python'. The path where to locate the "python" executable.
          Optional, for the server-side Nervatura Report.</li>
        <li><i>max_content_length</i>: Integer. Default value: 20000. See more <a href="https://github.com/ericmdantas/express-content-length-validator" 
          target="_blank">express-content-length-validator</a></li>
        <li><i>session_cookie_max_age</i>: Default value: 7*24*60*60*1000. See more <a href="https://github.com/expressjs/cookie-session" 
          target="blank">cookie-session</a></li>
        <li><i>session_secret</i>: See more <a href="https://github.com/expressjs/cookie-session" 
          target="blank">cookie-session</a></li>
        <li><i>host_restriction</i>: limiting server connections(ip pattern).
          <ul style="padding-left:15px;">
            <li>all_host_restriction: String.</li>
            <li>nas_host_restriction: String. NAS Admin GUI</li>
            <li>npi_host_restriction: String. Programming Interface</li>
            <li>ndi_host_restriction: String. Data Interface</li>
          </ul>
          <p class="code">all/nas/npi/ndi/dbs_host_restriction localhost sample:<br> ::1,127.0.0.1,::ffff:127.0.0.1</p>
        </li>
      </ul>
    </li>
  </ul>
  
  <h3>
		<a name="other">4. Other recipes</a>
	</h3>
  
  <ul>
    <li><b><a name="customize">Customize the appearance</a></b>
      <p>You can change the following setting in <a 
        href="https://github.com/nervatura/nervatura/blob/master/lib/node/conf.js" 
        target="blank">lib/node/<b>conf.js</b></a> file. </p>
      <ul>
        <li>Collaborate with other systems: different ports or multicontainers (default)
          <p class="code">start_page: "ntura"</p>
        </li>
        <li>Every custom modification in the <a 
        href="https://github.com/nervatura/nervatura/blob/master/www" 
        target="blank"><b>www</b></a> directory
          <p class="code">start_page: "static"</p>
        </li>
        <li>Custom NodeJs/Express functions: <a 
        href="https://github.com/nervatura/nervatura/blob/master/routes/custom.js" 
        target="blank">routes/custom.js<b></b></a>
          <p class="code">start_page: "custom"</p>
        </li>
      </ul>
    </li>

    <li><b><a name="migration">Database migration</a></b>
      <p>Customer database migration is the process of transferring data between storage types, formats, 
        or computer systems. Using the daily data backup is not recommended. 
        It may be helpful in the following situations:
        <ul>
          <li>switching to another database type, such as sqlite<->mysql, mysql<->postgresql, mssql<->mysql etc.</li>
          <li>transferring data between host servers</li>
          <li>exporting data to other formats</li>
        </ul>
      </p>
      <p><span style="font-weight:bold;">Data export</span></p> 
      <p>NAS Admin GUI/Database Management/Database Export.<br>
        <u>Data File</u><br>
        &nbsp;&nbsp;<i>alias:</i> Copy the aliasname_timestamp.data/xml file to the data_dir/data folder.<br>
        &nbsp;&nbsp;<i>download:</i> Download the result file.
        <br>
        <u>Export format</u><br>
        &nbsp;&nbsp;<i>data:</i> Compress data using deflate.<br>
        &nbsp;&nbsp;<i>xml:</i> XML text file.
      </p>
      <p><span style="font-weight:bold;">Data import</span></p> 
      <p>NAS Admin GUI/Database Management/Database Import.<br>
        <u>Data File:</u> Load the *.data/xml file from the data_dir/data folder</p>
    </li>
    
    <li><b><a name="printer">Server-side printers</a></b>
      <p>Network printer sample</p>
      <p class="code">
        <b>NDI URL:</b><br>
        http://localhost:8080/ndi/updateData?code=&amp;params=database=demo|username=demo|password=|datatype=tool|insert_row|insert_field
        &amp;data=serial=network_printer_name|description=Printer settings sample|partnumber=printer|
        toolgroup=printer|tool_printertype=network
        <br><br>
        <b>NDI JSON:</b><br>
        updateData({"datatype":"tool","insert_row":true,"insert_field":true},[{"serial":"network_printer_name",
        "description":"Printer settings sample","partnumber":"printer","toolgroup":"printer","tool_printertype":"network"}])
      </p>
      <p class="code">
        <b>NPI server-side printing(ui_printqueue rows):</b><br>
        <i>printQueue(printer::String, items::Array, orientation::String, size::String)</i><br>
        <br>
        data = {"id":11, "method":"callFunction", "jsonrpc":"2.0",<br> 
        &nbsp;&nbsp;"params":{<br>
        &nbsp;&nbsp;&nbsp;&nbsp;"login":{"database":"demo", "username":"admin", "password":""},<br>
        &nbsp;&nbsp;&nbsp;&nbsp;"functionName":"printQueue",<br> 
        &nbsp;&nbsp;&nbsp;&nbsp;"paramList":{"printer":"network_printer_name", "items":[12,14,15], "orientation":"p", "size":"a4"}}};<br>
        <br>
        Sample result: true
      </p>
    </li>

    <li><b><a name="emails">Sending Emails</a></b>
      <p>Configure your email settings in your</p>
      <ul>
        <li>environment variables or</li>
        <li><a href="https://github.com/nervatura/nervatura/blob/master/app.yaml" 
          target="blank"><b>app.yaml</b></a> file (<a href="#app_engine">Google App Engine</a>) or</li>
        <li><a href="https://github.com/nervatura/nervatura/blob/master/lib/node/conf.js" 
          target="blank">lib/node/<b>conf.js</b></a> file</li>
        </ul>
        <p class="code">
          <b><i>NPI email sending with attached report:</i></b><br>
          <i>sendEmail("provider"::String,<br> 
          &nbsp;&nbsp;"email"::Object{ "from"::String, "name"::String, "recipients"::Array[{"email"::String}],<br>
          &nbsp;&nbsp;&nbsp;&nbsp;"subject"::String, "text"::String, "html"::String,<br>
          &nbsp;&nbsp;&nbsp;&nbsp;"attachments"::Array[{ "filename"::String, "report_id"::Integer, "reportkey"::String,<br> 
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"ref_id"::Integer, "nervatype"::String, "refnumber"::String }] })</i><br>
          <br>
          data = {"id":11, "method":"callFunction", "jsonrpc":"2.0",<br> 
          &nbsp;&nbsp;"params":{<br>
          &nbsp;&nbsp;&nbsp;&nbsp;"login":{"database":"demo", "username":"admin", "password":""},<br>
          &nbsp;&nbsp;&nbsp;&nbsp;"functionName":"sendEmail",<br> 
          &nbsp;&nbsp;&nbsp;&nbsp;"paramList":{ "provider":"mailjet",<br> 
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"email":{"from":"info@nervatura.com", "name":"Nervatura", <br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"recipients":[{"email":"sample@company.com"}],<br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"subject":"Demo Invoice", "text":"Email sending with attached invoice",<br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"attachments":[{ "reportkey":"ntr_invoice_en", "nervatype":"trans", "refnumber":"DMINV/00001" }] }}}};<br>
          <br>
          Sample result: {"id":11,"jsonrpc":"2.0","result":{"Sent":[{"Email":"sample@company.com","MessageID":18859125621232550}]}}
        </p>
    </li>
    
    <li><b><a name="security">Security Issues</a></b>
      <p>
        The Nervatura Framework is based on the <a href="http://expressjs.com/" target="_blank">Express</a>. 
        If you discover a security vulnerability in Express, please see 
        <a href="https://github.com/strongloop/express/blob/master/Security.md" 
          target="_blank">Security Policies and Procedures</a>.<br>
        Please see more: <a href="http://expressjs.com/en/advanced/best-practice-security.html" 
          target="_blank">Express security best practices</a> and 
        <a href="http://expressjs.com/en/advanced/best-practice-performance.html" 
          target="_blank">Express performance best practices</a>
      </p>
      <p>Built-in security packages:</p>
      <ul>
        <li><a href="https://github.com/ericmdantas/express-content-length-validator" 
          target="_blank">express-content-length-validator</a>: large payload attacks</li>
        <li><a href="https://github.com/aredo/express-enforces-ssl" 
          target="_blank">express-enforces-ssl</a>: enforces HTTPS connections on any incoming requests (production environment)</li>
        <li><a href="https://github.com/helmetjs/helmet" 
          target="_blank">helmet</a>: Content Security Policy, DNS prefetching, clickjacking, 
          remove the X-Powered-By header, HTTP Public Key Pinning, HTTP Strict Transport Security, 
          X-Download-Options for IE8+, disable client-side caching, to keep clients from sniffing the MIME type, 
          some small XSS protections</li>
        <li><a href="https://github.com/analog-nico/hpp" 
          target="_blank">hpp</a>: HTTP Parameter Pollution attacks</li>
        <li><a href="https://github.com/krakenjs/lusca" 
          target="_blank">lusca</a>: Cross Site Request Forgery (CSRF)</li>
        <li><a href="https://github.com/jaredhanson/passport" 
          target="_blank">passport</a>, 
          <a href="https://github.com/jaredhanson/passport-local" 
          target="_blank">passport-local</a>: Username and password authentication (NAS Admin GUI)</li>
      </ul>
    </li>
  </ul>
  
</body></html>