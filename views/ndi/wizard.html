<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title><%= title %></title>
    <link rel="stylesheet" type="text/css" href="/stylesheets/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/stylesheets/bootstrap-datetimepicker.min.css">
    <link rel="stylesheet" href="/stylesheets/wizard.css" />
  </head>
  <body>
    <div class="panel panel-primary">
      <div class="panel-heading" style="padding:5px 30px;">
        <span>Ver.No: <%= settings.version %></span>
        <img style="padding:2px 10px 2px 10px;" src="/images/ntura_framework.png" height="64px" />
        <span style="font-size:30px;font-weight:bold;">Data Interface Wizard</span>
      </div>

      <form id="frm_wizard" action="/ndi/wizard/index" method="post">
      <input name="_csrf" value="<%= _csrf %>" type="hidden">
      <div class="panel-body">
        <% if (flash) { %><div class="flash"><%= flash %></div><% } %>

        <ul class="list-group" style="margin:0px;">
          <li class="list-group-item">
            <div class="form-inline">
              <label for="nom">NOM OBJECT</label>
              <select name="nom" id="nom" class="btn btn-primary"
                onchange="document.forms['frm_wizard'].submit();">
                <% lst_nom.forEach(function(nom) { %><% if (nom === data.nom) { %>
                <option value="<%= nom %>" selected="selected"><%= nom.toUpperCase() %></option><% } 
                else{ %><option value="<%= nom %>"><%= nom.toUpperCase() %></option><% } %>
                <% }); %>
              </select>
              <a role="button" class="btn btn-link"
                href="/docs/ndi#<%= data.nom %>_fields" target="_blank" >
                <span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span>
                <%= data.nom.toUpperCase() %> fieldname and type values</a>
              <a role="button" class="btn btn-link" 
                href="/docs/ndi#datatype_values" target="_blank" >
                <span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span>
                The datatype values</a>
            </div>
          </li>
          <li class="list-group-item">
            <a role="button" class="btn btn-default" 
              onclick="sendToServer();">
              <span class="glyphicon glyphicon-share" aria-hidden="true"></span>
              SEND NDI URL</a>
            <textarea id="rs_url" class="form-control" style="margin-top:5px;" rows="3"></textarea>
          </li>
          <li class="list-group-item">
            <label for="rs_server">JSON-RPC</label>
            <textarea id="rs_json" class="form-control" style="margin-top:5px;" readonly="readonly" rows="3"></textarea>
          </li>
          <li class="list-group-item">
            <label for="rs_server">SERVER SIDE</label>
            <textarea id="rs_server" class="form-control" style="margin-top:5px;" readonly="readonly" rows="3"></textarea>
          </li>
        </ul>

        <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
          <div class="panel panel-default" style="margin:0px;">
            <div class="panel-heading" role="tab" id="fsettings">
              <h4 class="panel-title">
                <a role="button" data-toggle="collapse" data-parent="#accordion" href="#settings" 
                  aria-expanded="true" aria-controls="settings" class="btn-collapse" style="">
                  <span class="glyphicon glyphicon-wrench" aria-hidden="true"></span> SETTINGS
                </a>
              </h4>
            </div>
            <div id="settings" class="panel-collapse collapse" role="tabpanel" aria-labelledby="fsettings">
              <div class="row" style="padding-top:15px;">
                <div class="col-sm-4">
                  <div class="form-group">
                    <label for="database" class="control-label">database</label>
                    <input name="database" id="database" value="<%= data.database %>" class="form-control" type="text">
                  </div>
                </div>
                <div class="col-sm-4">
                  <div class="form-group">
                    <label for="username" class="control-label">username</label>
                    <input name="username" id="username" value="<%= data.username %>" class="form-control" type="text">
                  </div>
                </div>
                <div class="col-sm-4">
                  <div class="form-group">
                    <label for="password" class="control-label">password</label>
                    <input name="password" id="password" value="<%= data.password %>" class="form-control" type="password">
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-sm-4">
                  <div class="form-group">
                    <label for="code" class="control-label">code</label>
                    <select name="code" id="code" class="form-control">
                      <option value=""></option>
                      <% url_code.forEach(function(code) { %>
                      <% if (code === data.code) { %>
                        <option value="<%= code %>" selected="selected"><%= code %></option>
                      <% } else{ %>
                      <option value="<%= code %>"><%= code %></option><% } %><% }); %>
                    </select>
                  </div>
                </div>
                <div class="col-sm-4">
                  <div class="form-group">
                    <label for="datatype" class="control-label">datatype</label>
                    <input name="datatype" id="datatype" value="<%= data.nom %>" 
                      class="form-control" disabled="disabled" type="text">
                  </div>
                </div>
                <div class="col-sm-4">
                  <div class="form-group">
                    <label for="use_deleted" class="control-label">use_deleted</label>
                    <select name="use_deleted" id="use_deleted" class="form-control">
                      <% if (data.use_deleted === 'true') { %>
                      <option value="true" selected="selected">true</option>
                      <option value="false">false</option><% } else{ %>
                      <option value="true">true</option>
                      <option value="false" selected="selected">false</option><% } %>
                    </select>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="panel panel-default" style="margin:0px;">
            <div class="panel-heading" role="tab" id="fview">
              <h4 class="panel-title">
                <a role="button" data-toggle="collapse" data-parent="#accordion" href="#view" 
                  aria-expanded="true" aria-controls="view" class="btn-collapse" style="">
                  <span class="glyphicon glyphicon-search" aria-hidden="true"></span> VIEW
                </a>
              </h4>
            </div>
            <div id="view" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="fview">
              <ul class="list-group" style="margin:0px;">
                <li class="list-group-item">
                  <div class="table-responsive" style="margin:0px;">
                    <table>
                      <tr>
                        <td style="vertical-align:top;">
                          <a role="button" class="btn btn-primary" 
                            onclick="$('#selected_tab').val('view');createView();" >
                            <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
                            Create</a>
                        </td>
                        <td style="padding-left:10px;">
                          <label for="output" class="control-label" >output</label>
                          <select name="output" id="output" class="form-control">
                            <% view_output.forEach(function(output) { %>
                            <option value="<%= output %>" <%=output===data.output? "selected=selected" : ""%> ><%=output %></option><% }); %>
                          </select>
                        </td>
                        <td style="padding-left:10px;">
                          <label for="cross_tab" class="control-label" >cross_tab</label>
                          <select name="cross_tab" id="cross_tab" class="form-control">
                            <% if (data.cross_tab === 'true') { %>
                            <option value="true" selected="selected">true</option>
                            <option value="false">false</option><% } else{ %>
                            <option value="true">true</option>
                            <option value="false" selected="selected">false</option><% } %>
                          </select>
                        </td>
                        <td style="padding-left:10px;">
                          <label for="show_id" class="control-label">show_id</label>
                          <select name="show_id" id="show_id" class="form-control">
                            <% if (data.show_id === 'true') { %>
                            <option value="true" selected="selected">true</option>
                            <option value="false">false</option>
                            <% } else{ %>
                            <option value="true">true</option>
                            <option value="false" selected="selected">false</option><% } %>
                          </select>
                        </td>
                        <td style="padding-left:10px;">
                          <% if (typeof view_nervatype[data.nom] !== 'undefined') { %><% if (data.nom === 'link') { %>
                            <label for="view_nervatype1" class="control-label">nervatype1</label>
                            <select id="view_nervatype1" name="view_nervatype1" class="form-control">
                              <option value=""></option><% view_nervatype[data.nom].forEach(function(nervatype) { %>
                              <option value="<%= nervatype %>" <%=data.view_nervatype1===nervatype? "selected=selected" : ""%>><%= nervatype %></option><% }); %>
                            </select>
                            <label for="view_nervatype2" class="control-label">nervatype2</label>
                            <select id="view_nervatype2" name="view_nervatype2" class="form-control">
                              <option value=""></option><% typeof view_nervatype[data.nom].forEach(function(nervatype) { %>
                              <option value="<%= nervatype %>" <%=data.view_nervatype2===nervatype? "selected=selected" : ""%>><%= nervatype %></option><% }); %>
                            </select>
                          <% } else{ %>
                            <label for="view_nervatype" class="control-label">nervatype</label>
                            <select id="view_nervatype" name="view_nervatype" class="form-control">
                              <option value=""></option><% view_nervatype[data.nom].forEach(function(nervatype) { %>
                              <option value="<%= nervatype %>" <%=data.view_nervatype===nervatype? "selected=selected" : ""%>><%= nervatype %></option><% }); %>
                            </select><% } %><% } %>
                        </td>
                        <td style="padding-left:10px;">
                          <% if (lst_no_deffield.indexOf(data.nom)===-1) { %>
                          <label for="no_deffield" class="control-label">no_deffield</label>
                          <select name="no_deffield" id="no_deffield" class="form-control">
                            <% if (data.no_deffield === 'true') { %>
                            <option value="true" selected="selected">true</option>
                            <option value="false">false</option>
                            <% } else{ %>
                            <option value="true">true</option>
                            <option value="false" selected="selected">false</option><% } %>
                          </select><% } %>
                        </td>
                      </tr>
                    </table>
                  </div>
                </li>
                <li class="list-group-item">
                  <div class="row">
                    <div class="col-sm-6">
                      <div class="form-group">
                        <label for="where" class="control-label">where</label>
                        <input name="where" id="where" value="<%= data.where %>" class="form-control" type="text">
                      </div>
                    </div>
                    <div class="col-sm-6">
                      <div class="form-group">
                        <label for="orderby" class="control-label">orderby</label>
                        <input name="orderby" id="orderby" value="<%= data.orderby %>" class="form-control" type="text">
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-sm-6">
                      <div class="form-group">
                        <label for="header" class="control-label">header</label>
                        <input name="header" id="header" value="<%= data.header %>" class="form-control" type="text">
                      </div>
                    </div>
                    <div class="col-sm-6">
                      <div class="form-group">
                        <label for="columns" class="control-label">columns</label>
                        <input name="columns" id="columns" value="<%= data.columns %>" class="form-control" type="text">
                      </div>
                    </div>
                  </div>
                </li>
              </ul>
            </div>
          </div>

          <% if (data.nom !== 'sql') { %>
          <div class="panel panel-default" style="margin:0px;">
            <div class="panel-heading" role="tab" id="fedit">
              <h4 class="panel-title">
                <a role="button" data-toggle="collapse" data-parent="#accordion" href="#edit" 
                  aria-expanded="true" aria-controls="edit" class="btn-collapse" style="">
                  <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> INSERT/UPDATE
                </a>
              </h4>
            </div>
            <div id="edit" class="panel-collapse collapse" role="tabpanel" aria-labelledby="fedit">
              <ul class="list-group" style="margin:0px;">
                <li class="list-group-item">
                  <div class="table-responsive" style="margin:0px;">
                    <table>
                      <tr>
                        <td style="vertical-align:top;">
                          <a role="button" class="btn btn-primary" 
                            onclick="$('#selected_tab').val('update');createUpdate('update');" >
                            <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
                            Create</a>
                        </td>
                        <td style="padding-left:10px;">
                          <label for="update_rows" class="control-label" >rows</label>
                          <select id="update_rows" name="update_rows" class="form-control"
                            onchange="$('#selected_tab').val('update');document.forms['frm_wizard'].submit();">
                            <% for (var i = 1; i < 10; i++) { %>
                            <option value="<%= i %>" <%=parseInt(data.update_rows,10)===i? "selected=selected" : ""%> ><%= i %></option><% } %>
                          </select>
                        </td>
                        <td style="padding-left:10px;">
                          <label for="insert_row" class="control-label" >insert_row</label>
                          <select name="insert_row" id="insert_row" class="form-control">
                            <% if (data.insert_row === 'true') { %>
                            <option value="true" selected="selected">true</option>
                            <option value="false">false</option><% } else{ %>
                            <option value="true">true</option>
                            <option value="false" selected="selected">false</option><% } %>
                          </select>
                        </td>
                        <td style="padding-left:10px;">
                          <% if (lst_no_deffield.indexOf(data.nom)===-1) { %>
                          <label for="insert_field" class="control-label">insert_field</label>
                          <select name="insert_field" id="insert_field" class="form-control">
                            <% if (data.insert_field === 'true') { %>
                            <option value="true" selected="selected">true</option>
                            <option value="false">false</option><% } else{ %>
                            <option value="true">true</option>
                            <option value="false" selected="selected">false</option><% } %>
                          </select><% } %>
                        </td>
                      </tr>
                    </table>
                  </div>
                </li>
                <li class="list-group-item">
                  <div class="table-responsive">
                    <table class="table table-striped" style="width:auto;">
                      <thead>
                        <tr>
                          <% for (var i = 0; i < parseInt(data.update_rows,10); i++) { %>
                          <th>
                            ROW <%= i+1 %>
                          </th><% } %>
                        </tr>
                      </thead>
                      <tbody id="rs_update">
                        <% data.fields_lst.forEach(function(field) { %>
                          <tr>
                            <% for (var i = 0; i < parseInt(data.update_rows,10); i++) { %>
                            <td>
                              <div class="checkbox">
                                <label><input id="cb_update"
                                  name="<%= 'cb_update_'+data.nom+'_'+field.fieldname+'_'+(i+1) %>" 
                                  type="checkbox" <%=data['cb_update_'+data.nom+'_'+field.fieldname+'_'+(i+1)]==="on"? "checked" : ""%> >
                                  <% if (field.label === field.fieldname) { %>
                                    <span class="<%= field.mtype %>"><%= field.fieldname %></span>
                                  <% } else{ %>
                                    <span class="small <%= field.mtype %>"><%= field.fieldname %></span><br><%= field.label %>
                                  <% } %></label></div>
                              <% if (field.fieldtype === 'valuelist') { %>
                                <select class="form-control" name="<%= 'update_'+data.nom+'_'+field.fieldname %>_<%= i+1 %>" 
                                  id="<%= field.fieldname %>_<%= i+1 %>">
                                  <option value=""></option><% field.values.forEach(function(value) { %>
                                  <option value="<%= value %>" <%=data['update_'+data.nom+'_'+field.fieldname+'_'+(i+1)]===value? "selected=selected" : ""%> ><%= value %></option><% }); %>
                                </select>
                              <% } else if (field.fieldtype === 'bool') { %>
                                <select class="form-control" name="<%= 'update_'+data.nom+'_'+field.fieldname %>_<%= i+1 %>" 
                                  id="<%= field.fieldname %>_<%= i+1 %>">
                                  <option value=""></option>
                                  <option value="true" <%=data['update_'+data.nom+'_'+field.fieldname+'_'+(i+1)]==='true'? "selected=selected" : ""%> >true</option>
                                  <option value="false" <%=data['update_'+data.nom+'_'+field.fieldname+'_'+(i+1)]==='false'? "selected=selected" : ""%> >false</option>
                                </select>
                              <% } else if (['date','datetime','float','integer'].indexOf(field.fieldtype) > -1) { %>
                                <input class="form-control" name="<%= 'update_'+data.nom+'_'+field.fieldname %>_<%= i+1 %>" 
                                  id="<%= field.fieldname %>_<%= i+1 %>" 
                                  value="<%= data['update_'+data.nom+'_'+field.fieldname+'_'+(i+1)] %>" 
                                  data-role="<%= field.fieldtype %>" type="text" >
                              <% } else{ %>
                                <input class="form-control" name="<%= 'update_'+data.nom+'_'+field.fieldname %>_<%= i+1 %>" 
                                  id="<%= field.fieldname %>_<%= i+1 %>" 
                                  value="<%= data['update_'+data.nom+'_'+field.fieldname+'_'+(i+1)] %>" 
                                  type="text"><% } %>
                            </td><% } %>
                          </tr><% }); %>
                      </tbody>
                    </table>
                  </div>
                </li>
              </ul>
            </div>
          </div><% } %>

          <% if (data.nom !== 'sql' && data.nom !== 'numberdef') { %>
          <div class="panel panel-default" style="margin:0px;">
            <div class="panel-heading" role="tab" id="fdelete">
              <h4 class="panel-title">
                <a role="button" data-toggle="collapse" data-parent="#accordion" href="#delete" 
                  aria-expanded="true" aria-controls="delete" class="btn-collapse" style="">
                  <span class="glyphicon glyphicon-trash" aria-hidden="true"></span> DELETE
                </a>
              </h4>
            </div>
            <div id="delete" class="panel-collapse collapse" role="tabpanel" aria-labelledby="fdelete">
              <ul class="list-group" style="margin:0px;">
                <li class="list-group-item">
                  <div class="form-inline">
                    <a role="button" class="btn btn-primary" 
                      onclick="$('#selected_tab').val('delete');createUpdate('delete');" >
                      <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
                      Create</a>
                    <div class="form-group">
                      <label for="delete_rows" class="control-label" >rows</label>
                      <select id="delete_rows" name="delete_rows" class="form-control"
                        onchange="$('#selected_tab').val('delete');document.forms['frm_wizard'].submit();"><% for (var i = 1; i < 10; i++) { %>
                        <option value="<%= i %>" <%=parseInt(data.delete_rows,10)===i? "selected=selected" : ""%> ><%= i %></option><% } %>
                      </select>
                    </div>
                  </div>
                </li>
                <li>
                  <div class="table-responsive">
                    <table id="rs_delete" class="table table-striped" style="width:auto;">
                      <thead>
                        <tr>
                          <th></th><% for (var i = 0; i < parseInt(data.delete_rows,10); i++) { %>
                          <th>
                            <input id="cb_delete"
                              name="<%= 'cb_delete_'+data.nom+'_'+(i+1) %>" 
                              type="checkbox" <%=data['cb_delete_'+data.nom+'_'+(i+1)]==="on"? "checked" : ""%> >
                            <span>ROW <%= i+1 %></span>
                          </th><% } %>
                        </tr>
                      </thead>
                      <tbody>
                        <% data.fields_lst.forEach(function(field) { %>
                        <% if (field.fieldcat === 0) { %>
                        <tr>
                          <% if (field.label === field.fieldname) { %>
                          <td><span class="<%= field.mtype %>"><%= field.fieldname %></span></td><% } else{ %>
                          <td><span class="<%= field.mtype %>"><%= field.fieldname %><br><%= field.label %></span></td><% } %>
                          <% for (var i = 0; i < parseInt(data.delete_rows,10); i++) { %>
                          <td>
                            <% if (field.fieldtype === 'valuelist') { %>
                            <select class="form-control" 
                              name="<%= 'delete_'+data.nom+'_'+field.fieldname %>_<%= i+1 %>" 
                              id="<%= 'delete_'+data.nom+'_'+(i+1) %>">
                              <option value=""></option><% field.values.forEach(function(value) { %>
                              <option value="<%= value %>" <%=data['delete_'+data.nom+'_'+field.fieldname+'_'+(i+1)]===value? "selected=selected" : ""%> ><%= value %></option><% }); %>
                            </select><% } else if (field.fieldtype === 'bool') { %>
                            <select class="form-control" 
                              name="<%= 'delete_'+data.nom+'_'+field.fieldname %>_<%= i+1 %>" 
                              id="<%= 'delete_'+data.nom+'_'+(i+1) %>">
                              <option value=""></option>
                              <option value="true" <%=data['delete_'+data.nom+'_'+field.fieldname+'_'+(i+1)]==='true'? "selected=selected" : ""%> >true</option>
                              <option value="false" <%=data['delete_'+data.nom+'_'+field.fieldname+'_'+(i+1)]==='false'? "selected=selected" : ""%> >false</option>
                            </select>
                            <% } else if (['date','datetime','float','integer'].indexOf(field.fieldtype) > -1) { %>
                            <input class="form-control" name="<%= 'delete_'+data.nom+'_'+field.fieldname %>_<%= i+1 %>" 
                              id="<%= 'delete_'+data.nom+'_'+(i+1) %>" 
                              value="<%= data['delete_'+data.nom+'_'+field.fieldname+'_'+(i+1)] %>" data-role="<%= field.fieldtype %>" type="text" >
                            <% } else{ %>
                            <input class="form-control" 
                              name="<%= 'delete_'+data.nom+'_'+field.fieldname %>_<%= i+1 %>" 
                              id="<%= 'delete_'+data.nom+'_'+(i+1) %>" 
                              value="<%= data['delete_'+data.nom+'_'+field.fieldname+'_'+(i+1)] %>" type="text"><% } %>
                          </td><% } %>
                        </tr><% } %><% }); %>
                      </tbody>
                    </table>
                  </div>
                </li>
              </ul>
            </div>
          </div><% } %>

        </div>
        <input value="<%= data.selected_tab %>" name="selected_tab" id="selected_tab" type="hidden">
        </form>
      </div>
    </div>

    <script type="text/javascript" src="/javascripts/jquery.min.js"></script>
    <script type="text/javascript" src="/javascripts/jquery.base64.js"></script>
    <script type="text/javascript" src="/javascripts/bootstrap.min.js"></script>
    <script type="text/javascript" src="/javascripts/bootstrap-datetimepicker.min.js"></script>
    <script type="text/javascript" src="/javascripts/wizard.js"></script>
    <script type="text/javascript">
      $(document).ready(function() {
        $('input[data-role=date]').datetimepicker({
          format: 'yyyy-mm-dd', weekStart: 1, todayBtn: 1, autoclose: 1, 
          todayHighlight: 1, startView: 2, minView: 2, forceParse: 1});
        $('input[data-role=datetime]').datetimepicker({
          format: 'yyyy-mm-dd hh:ii', weekStart: 1, todayBtn: 1, autoclose: 1, 
          todayHighlight: 1, startView: 2, minView: 0, forceParse: 1});
        $("input[data-role=integer]").keyup(function() {
          this.value=String(this.value).replace(/[^0-9\-]|\-(?=.)/g,'');});
        $("input[data-role=float]").keyup(function() {
          this.value=String(this.value).replace(/[^0-9\-\.]|[\-](?=.)|[\.](?=[0-9]*[\.])/g,'');});});
    </script>
  </body>
</html>
