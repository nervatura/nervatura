"use strict";(self.webpackChunknervatura_client=self.webpackChunknervatura_client||[]).push([[330],{3331:function(e,r,t){t.d(r,{Z:function(){return d}});var a=t(1413),n=t(4925),s="Select_selectStyle__kV5uh",o="Select_optionStyle__hc7Dx",l="Select_optionPlaceholder__1tEB7",i=t(6417),u=["options","placeholder","className","onChange"],c=function(e){var r=e.options,t=e.placeholder,c=e.className,d=e.onChange,m=(0,n.Z)(e,u),g=r.map((function(e,r){return(0,i.jsx)("option",{className:"".concat(o),value:e.value,children:e.text},r)}));return"undefined"!==typeof t&&g.unshift((0,i.jsx)("option",{className:" ".concat(o," ").concat(l),value:"",children:t},"placeholder")),(0,i.jsx)("select",(0,a.Z)((0,a.Z)({},m),{},{className:"".concat(c," ").concat(s),onChange:function(e){return d(e.target.value)},children:g}))};c.defaultProps={options:[],placeholder:void 0,className:"",onChange:void 0};var d=c},7718:function(e,r,t){t.r(r),t.d(r,{default:function(){return $}});var a=t(4942),n=t(5861),s=t(1413),o=t(885),l=t(7757),i=t.n(l),u=t(7313),c=t(4754),d=t.n(c),m=t(7559),g=t(9155),p=t(4925),f="Login_inputMargin__Iu818",v="Login_borderButton__BmzVE",h="Login_title__vcg8P",x="Login_version__pQpMb",_="Login_modal__nr6qg",y="Login_middle__6d6jf",b="Login_dialog__bOFEw",j=t(8907),k=t(6360),N=t(3331),w=t(4721),Z=t(5750),L=t(6417),T=["theme","version","locales","lang","username","password","database","server","onLogin","setTheme","setLocale","getText","changeData","serverURL"],S=function(e){var r=e.theme,t=e.version,a=e.locales,n=e.lang,o=e.username,l=e.password,i=e.database,u=e.server,c=e.onLogin,d=e.setTheme,m=e.setLocale,g=e.getText,S=e.changeData,E=e.serverURL,P=(0,p.Z)(e,T);return(0,L.jsx)("div",{className:_,children:(0,L.jsx)("div",{className:y,children:(0,L.jsxs)("div",(0,s.Z)((0,s.Z)({},P),{},{className:"".concat(b," ").concat(r),children:[(0,L.jsxs)("div",{className:"row primary".concat(" ",h),children:[(0,L.jsx)("div",{className:"cell",children:(0,L.jsx)(j.Z,{value:g("title_login")})}),(0,L.jsx)("div",{className:"cell".concat(" ",x),children:(0,L.jsx)(j.Z,{value:"v"+t})})]}),(0,L.jsxs)("div",{className:"row full section-small",children:[(0,L.jsxs)("div",{className:"row full section-small",children:[(0,L.jsxs)("div",{className:"row full",children:[(0,L.jsx)("div",{className:"padding-normal s12 m4 l4",children:(0,L.jsx)(j.Z,{value:g("login_username"),className:"bold"})}),(0,L.jsx)("div",{className:"container s12 m8 l8",children:(0,L.jsx)(k.Z,{id:"username",type:"text",className:"full".concat(" ",f),value:o,onChange:function(e){return S("username",e)}})})]}),(0,L.jsxs)("div",{className:"row full",children:[(0,L.jsx)("div",{className:"padding-normal s12 m4 l4",children:(0,L.jsx)(j.Z,{value:g("login_password"),className:"bold"})}),(0,L.jsx)("div",{className:"container s12 m8 l8",children:(0,L.jsx)(k.Z,{id:"password",type:"password",className:"full".concat(" ",f),value:l,onChange:function(e){return S("password",e)},onEnter:c})})]})]}),(0,L.jsxs)("div",{className:"row full section-small",children:[(0,L.jsxs)("div",{className:"row full",children:[(0,L.jsx)("div",{className:"padding-normal s12 m4 l4",children:(0,L.jsx)(j.Z,{value:g("login_database"),className:"bold"})}),(0,L.jsx)("div",{className:"container s12 m8 l8",children:(0,L.jsx)(k.Z,{id:"database",type:"text",className:"full".concat(" ",f),value:i,onChange:function(e){return S("database",e)},onEnter:c})})]}),"SERVER"!==E?(0,L.jsxs)("div",{className:"row full",children:[(0,L.jsx)("div",{className:"padding-normal full",children:(0,L.jsx)(j.Z,{value:g("login_server"),className:"bold"})}),(0,L.jsx)("div",{className:"container full",children:(0,L.jsx)(k.Z,{id:"server",type:"text",className:"full".concat(" ",f),value:u,onChange:function(e){return S("server",e)}})})]}):null]})]}),(0,L.jsxs)("div",{className:"row full section-small secondary-title",children:[(0,L.jsxs)("div",{className:"container section-small s6 m6 l6",children:[(0,L.jsx)(w.Z,{id:"theme",className:"border-button".concat(" ",v),value:"dark"===r?(0,L.jsx)(Z.Z,{iconKey:"Sun",width:18,height:18}):(0,L.jsx)(Z.Z,{iconKey:"Moon",width:18,height:18}),onClick:d}),(0,L.jsx)(N.Z,{id:"lang",value:n,options:Object.keys(a).map((function(e){return{value:e,text:a[e][e]||e}})),onChange:function(e){return m(e)}})]}),(0,L.jsx)("div",{className:"container section-small s6 m6 l6",children:(0,L.jsx)(w.Z,{id:"login",autoFocus:!0,disabled:o&&0!==String(o).length&&i&&0!==String(i).length?"":"disabled",className:"primary full",label:g("login_login"),onClick:c})})]})]}))})})};S.defaultProps={theme:"light",version:"",locales:{},lang:"en",username:"",password:"",database:"",server:"",serverURL:"SERVER",changeData:void 0,getText:void 0,onLogin:void 0,setTheme:void 0,setLocale:void 0};var E=S,P=function(e){var r=e.session,t=e.data,a=e.current,n=e.locales,o=e.changeData,l=e.getText,i=e.onLogin,u=e.setTheme,c=e.setLocale;return(0,L.jsx)(E,(0,s.Z)((0,s.Z)({},t),{},{theme:a.theme,lang:a.lang,version:r.version,locales:n,changeData:o,getText:l,onLogin:i,setTheme:u,setLocale:c}))};P.defaultProps={data:{username:E.defaultProps.username,password:E.defaultProps.password,database:E.defaultProps.database,server:E.defaultProps.server},session:{},locales:{},current:{},changeData:void 0,getText:void 0,onLogin:void 0,setTheme:void 0,setLocale:void 0};var D=(0,u.memo)(P,(function(e,r){return e.data===r.data&&e.current.theme===r.current.theme&&e.current.lang===r.current.lang&&e.locales===r.locales})),C=function(e){var r=(0,u.useContext)(m.ZP),t=r.data,l=r.setData,c=(0,g.xZ)(t,l),p=(0,u.useState)(d()(e,{$merge:{session:t.session}})),f=(0,o.Z)(p,1)[0];return f.data=d()(f.data,{$merge:(0,s.Z)({},t[f.key])}),f.current=d()(f.current,{$merge:(0,s.Z)({},t.current)}),f.locales=d()(f.locales,{$merge:(0,s.Z)({},t.session.locales)}),(0,u.useEffect)((function(){if(f.data.auth){var e=f.data.auth;l("login",{auth:null},(0,n.Z)(i().mark((function r(){var t;return i().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,f.loginData(e);case 2:if(!(t=r.sent).error){r.next=5;break}return r.abrupt("return",c.resultError(t));case 5:f.setLogin(t);case 6:case"end":return r.stop()}}),r)}))))}}),[l,f,c]),f.getText=function(e,r){return c.getText(e,r)},f.userLog=function(){var e=(0,n.Z)(i().mark((function e(r){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={method:"POST",token:r.token,data:[{keys:{employee_id:r.employee.empnumber,logstate:"login"}}]},e.next=3,c.requestData("/log",t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),f.loginData=function(){var e=(0,n.Z)(i().mark((function e(r){var t,n,s,o,l;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=d()(f.data,{$set:{token:r.token,engine:r.engine}}),n=[{key:"employee",text:(0,g.aT)(r.engine,{select:["e.*","ug.groupvalue as usergroupName","dp.groupvalue as departmentName"],from:"employee e",inner_join:["groups ug","on",["e.usergroup","=","ug.id"]],left_join:["groups dp","on",["e.department","=","dp.id"]],where:["username","=","?"]}).sql,values:[f.data.username]},{key:"menuCmds",text:(0,g.aT)(r.engine,{select:["m.*","st.groupvalue as methodName"],from:"ui_menu m",inner_join:["groups st","on",["m.method","=","st.id"]]}).sql,values:[]},{key:"menuFields",text:(0,g.aT)(r.engine,{select:["mf.*","ft.groupvalue as fieldtypeName"],from:"ui_menufields mf",inner_join:["groups ft","on",["mf.fieldtype","=","ft.id"]],order_by:["menu_id","orderby"]}).sql,values:[]},{key:"userlogin",text:(0,g.aT)(r.engine,{select:["value"],from:"fieldvalue",where:[["ref_id","is","null"],["and","fieldname","=","'log_login'"]]}).sql,values:[]},{key:"groups",text:(0,g.aT)(r.engine,{select:["*"],from:"groups",where:["groupname","in",[[],"'usergroup'","'nervatype'","'transtype'","'inputfilter'","'transfilter'","'department'","'logstate'","'fieldtype'","'service'"]]}).sql,values:[]}],s={method:"POST",token:r.token,data:n},e.next=5,c.requestData("/view",s);case 5:if(!(o=e.sent).error){e.next=8;break}return e.abrupt("return",o);case 8:return t=d()(t,{$merge:o}),t=d()(t,{$merge:{employee:t.employee[0],userlogin:t.userlogin.length>0?t.userlogin[0].value:"false"}}),n=[{key:"audit",text:(0,g.aT)(r.engine,{select:["au.nervatype","nt.groupvalue as nervatypeName","au.subtype","case when nt.groupvalue = 'trans' then st.groupvalue else m.menukey end as subtypeName","au.inputfilter","ip.groupvalue as inputfilterName","au.supervisor"],from:"ui_audit au",inner_join:[["groups nt","on",["au.nervatype","=","nt.id"]],["groups ip","on",["au.inputfilter","=","ip.id"]]],left_join:[["groups st","on",["au.subtype","=","st.id"]],["ui_menu m","on",["au.subtype","=","m.id"]]],where:["au.usergroup","=","?"]}).sql,values:[t.employee.usergroup]},{key:"transfilter",text:(0,g.aT)(r.engine,{select:["ref_id_2 as transfilter","g.groupvalue as transfilterName"],from:"link",inner_join:["groups g","on",["link.ref_id_2","=","g.id"]],where:[["ref_id_1","=","?"],["and","link.deleted","=","0"],["and","nervatype_1","in",[{select:["id"],from:"groups",where:[["groupname","=","'nervatype'"],["and","groupvalue","=","'groups'"]]}]],["and","nervatype_2","in",[{select:["id"],from:"groups",where:[["groupname","=","'nervatype'"],["and","groupvalue","=","'groups'"]]}]]]}).sql,values:[t.employee.usergroup]}],s={method:"POST",token:r.token,data:n},e.next=14,c.requestData("/view",s);case 14:if(!(o=e.sent).error){e.next=17;break}return e.abrupt("return",o);case 17:return null===(t=d()(t,{$merge:{transfilter:o.transfilter.length>0?o.transfilter[0].transfilter:null,audit:o.audit}})).transfilter?(l=t.groups.filter((function(e){return"transfilter"===e.groupname&&"all"===e.groupvalue}))[0],t=d()(t,{$merge:{transfilter:l.id,transfilterName:"all"}})):t=d()(t,{$merge:{transfilterName:o.transfilter[0].transfilterName}}),t=d()(t,{$merge:{audit_filter:{trans:{},menu:{},report:{}},edit_new:[[],[],[],[]]}}),[["offer",0],["order",0],["worksheet",0],["rent",0],["invoice",0],["receipt",0],["bank",1],["cash",1],["delivery",2],["inventory",2],["waybill",2],["production",2],["formula",2]].forEach((function(e){var r=t.audit.filter((function(r){return"trans"===r.nervatypeName&&r.subtypeName===e[0]}))[0];"disabled"!==(t=d()(t,{audit_filter:{trans:{$merge:(0,a.Z)({},e[0],r?[r.inputfilterName,r.supervisor]:["all",1])}}})).audit_filter.trans[e[0]][0]&&(t=d()(t,{edit_new:(0,a.Z)({},e[1],{$push:[e[0]]})}))})),["customer","product","employee","tool","project","setting","audit"].forEach((function(e){var r=t.audit.filter((function(r){return r.nervatypeName===e&&null===r.subtypeName}))[0];"disabled"!==(t=d()(t,{audit_filter:{$merge:(0,a.Z)({},e,r?[r.inputfilterName,r.supervisor]:["all",1])}})).audit_filter[e][0]&&"setting"!==e&&"audit"!==e&&(t=d()(t,{edit_new:{3:{$push:[e]}}}))})),e.abrupt("return",t);case 25:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),f.onLogin=(0,n.Z)(i().mark((function e(){var r,a,n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={method:"POST",data:{username:f.data.username,password:f.data.password,database:f.data.database}},e.next=3,c.requestData("/auth/login",r);case 3:if(!(a=e.sent).token||!a.engine){e.next=17;break}if(t.session.engines.includes(a.engine)){e.next=7;break}return e.abrupt("return",c.resultError({error:{message:c.getText("login_engine_err")}}));case 7:if(t.session.service.includes(a.version)){e.next=9;break}return e.abrupt("return",c.resultError({error:{message:c.getText("login_version_err")}}));case 9:return e.next=11,f.loginData(a);case 11:if(!(n=e.sent).error){e.next=14;break}return e.abrupt("return",c.resultError(n));case 14:f.setLogin(n),e.next=18;break;case 17:c.resultError(a);case 18:case"end":return e.stop()}}),e)}))),f.setLogin=function(){var e=(0,n.Z)(i().mark((function e(r){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("t"!==r.userlogin&&"true"!==r.userlogin){e.next=6;break}return e.next=3,f.userLog(r);case 3:if(!(t=e.sent).error){e.next=6;break}return e.abrupt("return",c.resultError(t));case 6:l("current",{module:"search"}),l(f.key,{data:r}),localStorage.setItem("database",f.data.database),localStorage.setItem("username",f.data.username),localStorage.setItem("server",f.data.server),c.loadBookmark({user_id:r.employee.id,token:r.token});case 12:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),f.changeData=function(e,r){l(f.key,(0,a.Z)({},e,r))},f.setTheme=function(){var e="light"===f.current.theme?"dark":"light";l("current",{theme:e}),localStorage.setItem("theme",e)},f.setLocale=function(e){l("current",{lang:e}),localStorage.setItem("lang",e)},(0,L.jsx)(D,(0,s.Z)({},f))};C.defaultProps=(0,s.Z)((0,s.Z)({key:"login"},P.defaultProps),{},{data:(0,s.Z)((0,s.Z)({},P.defaultProps.data),{},{data:{}}),userLog:void 0,loginData:void 0});var $=C},4925:function(e,r,t){function a(e,r){if(null==e)return{};var t,a,n=function(e,r){if(null==e)return{};var t,a,n={},s=Object.keys(e);for(a=0;a<s.length;a++)t=s[a],r.indexOf(t)>=0||(n[t]=e[t]);return n}(e,r);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)t=s[a],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(n[t]=e[t])}return n}t.d(r,{Z:function(){return a}})}}]);