{"meta":{"report_key":"csv_vat_en","report_type":"REPORT","report_name":"VAT Summary - CSV output.","description":"Recoverable and payable VAT summary grouped by currency.","label":"Invoice","file_type":"FILE_CSV"},"details":[{"columns":["curr","taxcode","netamount_out","vatamount_out","netamount_in","vatamount_in","vatamount_diff"],"name":"tax_total","databind":"total"},{"columns":["curr","transnumber","duedate","custname","taxcode","netamount","vatamount","amount"],"name":"items","databind":"ds"}],"sources":{"total":{"default":"select t.currency_code as curr, case when t.tax_free then 'NOTAX' else ti.tax_code end as taxcode, sum(case when t.direction = 'DIRECTION_OUT' then ti.net_amount else 0 end) as netamount_out, sum(case when t.direction = 'DIRECTION_IN' then ti.net_amount else 0 end) as netamount_in, sum(case when t.direction = 'DIRECTION_OUT' then ti.vat_amount else 0 end) as vatamount_out, sum(case when t.direction = 'DIRECTION_IN' then ti.vat_amount else 0 end) as vatamount_in, sum(case when t.direction = 'DIRECTION_OUT' then ti.amount else 0 end) as amount_out, sum(case when t.direction = 'DIRECTION_IN' then ti.amount else 0 end) as amount_in, sum(case when t.direction = 'DIRECTION_IN' then ti.vat_amount else 0 end - case when t.direction = 'DIRECTION_OUT' then ti.vat_amount else 0 end) as vatamount_diff from trans_view t inner join item_view ti on t.code = ti.trans_code where t.trans_type='TRANS_INVOICE' and t.trans_date >= @date_from and t.trans_date <= @date_to @where_str group by t.currency_code, case when t.tax_free then 'NOTAX' else ti.tax_code end order by t.currency_code DESC, case when t.tax_free then 'NOTAX' else ti.tax_code end DESC"},"ds":{"default":"select @date_from as date_from, @date_to as date_to, t.code as transnumber, substr(cast(t.time_stamp as char(10)), 1, 10) as crdate, t.trans_date, substr(cast(t.due_time as char(10)), 1, 10) as  duedate, c.customer_name as custname, t.currency_code as curr, t.direction, case when t.tax_free then 'NOTAX' else ti.tax_code end as taxcode, case when t.direction = 'DIRECTION_IN' then 0-sum(ti.net_amount) else sum(ti.net_amount) end as netamount, case when t.direction = 'DIRECTION_IN' then 0-sum(ti.vat_amount) else sum(ti.vat_amount) end as vatamount, case when t.direction = 'DIRECTION_IN' then 0-sum(ti.amount) else sum(ti.amount) end as amount from trans_view t inner join item_view ti on t.code = ti.trans_code inner join customer c on t.customer_code = c.code where t.trans_type='TRANS_INVOICE' and t.trans_date >= @date_from and t.trans_date <= @date_to @where_str group by t.code, substr(cast(t.time_stamp as char(10)), 1, 10), t.trans_date, substr(cast(t.due_time as char(10)), 1, 10), c.customer_name, t.currency_code, t.direction, case when t.tax_free then 'NOTAX' else ti.tax_code end order by t.currency_code DESC, t.direction, t.trans_date","mssql":"select @date_from as date_from, @date_to as date_to, t.code as transnumber, CONVERT(VARCHAR(10), t.time_stamp, 120) as crdate, t.trans_date, CONVERT(VARCHAR(10), t.due_time, 120) as  duedate, c.customer_name as custname, t.currency_code as curr, t.direction, case when t.tax_free then 'NOTAX' else ti.tax_code end as taxcode, case when t.direction = 'DIRECTION_IN' then 0-sum(ti.net_amount) else sum(ti.net_amount) end as netamount, case when t.direction = 'DIRECTION_IN' then 0-sum(ti.vat_amount) else sum(ti.vat_amount) end as vatamount, case when t.direction = 'DIRECTION_IN' then 0-sum(ti.amount) else sum(ti.amount) end as amount from trans_view t inner join item_view ti on t.code = ti.trans_code inner join customer c on t.customer_code = c.code where t.trans_type='TRANS_INVOICE' and t.trans_date >= @date_from and t.trans_date <= @date_to @where_str group by t.code, CONVERT(VARCHAR(10), t.time_stamp, 120), t.trans_date, CONVERT(VARCHAR(10), t.due_time, 120), c.customer_name, t.currency_code, t.direction, case when t.tax_free then 'NOTAX' else ti.tax_code end order by t.currency_code DESC, t.direction, t.trans_date"}},"fields":{"date_from":{"fieldtype":"date","wheretype":"in","description":"From date","orderby":0,"defvalue":"-360"},"date_to":{"fieldtype":"date","wheretype":"in","description":"To date","orderby":1},"curr":{"fieldtype":"string","wheretype":"where","description":"Currency","orderby":2,"sqlstr":" t.currency_code = @curr"}},"data":{"labels":{"curr":"Currency","taxcode":"VAT%","netamount_out":"Net income","vatamount_out":"VAT(+)","netamount_in":"Net payment","vatamount_in":"VAT(-)","vatamount_diff":"VAT Diff.","transnumber":"Invoice No.","duedate":"Due Date","custname":"Customer","netamount":"Net","vatamount":"VAT amount","amount":"Gross"}}}